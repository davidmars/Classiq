!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=26)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(9),s=(i=r)&&i.__esModule?i:{default:i};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase()},c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.$main=e;var i=function(e){if(e.constructor.name)return e.constructor.name;var t=new RegExp(/^\s*function\s*(\S*)\s*\(/);return(i=function(e){return e.constructor.toString().match(t)[1]})(e)},o=i(n);return n.ATTR=l(o),n.CLASS_NAME=n.constructor.name,void 0!==e&&e.length<1?(console.error("$main DisplayObject introuvable "+n.CLASS_NAME+" / "+n.ATTR,e),!1,a(n,!1)):(t.allInstances.push(n),n.$main.data(n.CLASS_NAME)?(console.error(n.CLASS_NAME+" déjà construit!",e),a(n,n.$main.data(n.CLASS_NAME))):(n.$main.data(n.CLASS_NAME,n),n.$main.attr(n.ATTR,"init"),n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"width",value:function(){return this.$main.width()}},{key:"height",value:function(){return this.$main.height()}},{key:"isInDom",value:function(){return this.$main.closest("html").length>0}},{key:"destroy",value:function(){console.warn("destroy not implemented for "+this.constructor.name)}},{key:"addTempClass",value:function(e,t){var n=this;n.$main.addClass(e),setTimeout(function(){n.$main.removeClass(e)},t)}}],[{key:"__fromDom",value:function(e,t){$("["+t+"]").not("["+t+"='init']").each(function(){new e($(this))})}},{key:"cleanfromDom",value:function(){$.each(t.allInstances,function(e,n){n.isInDom()||(n.destroy()||(t.allInstances[e]=null))});var e=[];$.each(t.allInstances,function(t,n){null!==n&&e.push(n)}),t.allInstances=e}}]),t}();t.default=c,c.allInstances=[],function(e){e.fn.displayObject=function(){if(!(e(this).length>1))return e(this).data("displayobject")?e(this).data("displayobject"):(console.error("pas de displayObject ici",e(this)),null);console.error("displayObject multiple",e(this))}}(jQuery)},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(44),s=(i=r)&&i.__esModule?i:{default:i};var a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.data("WysiwygField"))return t.data("WysiwygField");t.data("WysiwygField",this),this.$field=t,this.type=t.attr("wysiwyg-type"),this.id=t.attr("wysiwyg-id"),this.var=t.attr("wysiwyg-var"),this.dataType=t.attr("wysiwyg-data-type"),this.dataTypeFormat=t.attr("wysiwyg-data-type-format"),this.onSavedAction=t.attr("wysiwyg-on-saved-action"),this.__onInputTimeout=null}return o(e,[{key:"onSavedActionSelector",value:function(){return this.$field.attr("wysiwyg-on-saved-action-selector")}},{key:"doSave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.loading(!0);var i=this;if(i.__onInputTimeout&&(clearTimeout(i.__onInputTimeout),i.__onInputTimeout=null),e){var o={modelType:this.type,modelId:this.id};o.options=n,o.modelVars={},o.modelVars[this.var]=this.value(),this.loading(!0),window.pov.api.save(o,function(e){if(i.loading(!1),i.onSavedAction)switch(i.onSavedAction){case"refresh":i.$field.evalHere(i.onSavedActionSelector()).povRefresh();break;case"reload":location.reload(!0);break;default:console.error("on saved non géré",i.onSavedAction)}if(i.$field.trigger(EVENTS.SAVED),e.errors){var n=!0,o=!1,r=void 0;try{for(var s,a=e.errors[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;wysiwyg.notifier.notify(l,10,"danger")}}catch(l){o=!0,r=l}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}t&&t(e)})}else i.__onInputTimeout=setTimeout(function(){i.doSave(!0,t)},2e3)}},{key:"value",value:function(){switch(this.dataType){case"string":if(this.$field.is("input,textarea,select"))return this.$field.val();if(this.$field.is("[contenteditable]")){this.$field.find("a,span,div").filter(function(){return""===$.trim($(this).text())}).remove();var e=this.$field.html();return e=s.default.format(e,this.dataTypeFormat)}console.error("type de champ string non géré",this.$field);break;case"file":case"image":if(this.$field.is("[wysiwyg-value]"))return this.$field.attr("wysiwyg-value");console.error("type de champ file non géré",this.$field);break;case"records":if(this.$field.is("input,textarea,button"))return this.$field.val();console.error("type de champ records non géré, on ne sait pas comment récupérer les uids",this.$field);break;case"list":var t={},n=!0;return this.$field.children(["list-item-path"]).each(function(){var e=void 0,i=void 0;if($(this).attr("list-item-key"))i=$(this).attr("list-item-key"),n=!1;else if(!$(this).attr("cq-block-picker")){n=!1;var o="Vous avez probalement oublié de mettre les attributs ListItem->attr() sur votre balise d'item";return console.error(o),void alert(o)}(e={}).path=$(this).attr("list-item-path");var r=$(this).getMoreVars();$.each(r,function(t,n){e[t]=n}),t[i]=e}),(n||0===t.length||!t||$.isEmptyObject(t))&&(t=[""]),t;default:console.error("type de champ non géré ("+this.dataType+")")}}},{key:"loading",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(this.$field.addClass("wysiwyg-loading"),this.onSavedActionSelector()&&this.$field.evalHere(this.onSavedActionSelector()).addClass("wysiwyg-loading")):(this.$field.removeClass("wysiwyg-loading"),this.onSavedActionSelector()&&this.$field.evalHere(this.onSavedActionSelector()).removeClass("wysiwyg-loading"))}},{key:"mirror",value:function(){var e=this,t=$("[wysiwyg-var='"+this.var+"']").filter("[wysiwyg-id='"+this.id+"']").filter("[wysiwyg-type='"+this.type+"']").filter("[wysiwyg-data-type='"+this.dataType+"']").not(this.$field);"string"===this.dataType&&t.each(function(){$(this).is("input,textarea,select")?$(this).val(e.value()):$(this).is("[contenteditable]")?$(this).html(e.value()):console.error("type de champ string non géré (mirror)",e.$field,$(this))})}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={},this.name=t,localStorage.getItem(t)&&(this.data=JSON.parse(localStorage.getItem(t)))}return i(e,[{key:"setValue",value:function(e,t){this.data[e]=t,localStorage.setItem(this.name,JSON.stringify(this.data))}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.data[e];return void 0!==n?n:t}}]),e}();t.default=o},function(e,t,n){var i=n(31);i.Template=n(32).Template,i.template=i.Template,e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};var a=n(16);n(51);var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.sortable=null,e[0]?i.sortable=a.create(e[0],{group:{name:"receiver",put:["lib"]},cancel:null,animation:100}):console.error("sortable vide !!!"),a.utils.on(e[0],"sort",function(t){console.log("change sortable"),e.trigger("change")}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"$items",value:function(){return this.$main.children()}},{key:"destroy",value:function(){this.sortable.destroy()}}]),t}();t.default=l,$.fn.CqSortable=function(){return $(this).is("[cq-sortable='init']")?$(this).data("CqSortable"):new l($(this))}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=b(n(0)),r=b(n(27)),s=b(n(3)),a=b(n(45)),l=b(n(47)),c=b(n(50)),u=b(n(59)),d=b(n(60)),h=b(n(66)),f=b(n(6)),p=b(n(73)),m=b(n(14)),v=b(n(74)),g=n(76);function b(e){return e&&e.__esModule?e:{default:e}}n(78),n(79),n(80),n(81);var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=this;setTimeout(function(){t._boot(),t._initListeners(),window.cqAdmin=new v.default},10)}return i(e,[{key:"_boot",value:function(){console.log("boot Wysiwyg",this),this.bigMenu=new r.default($("#the-cq-big-menu")),this.contextMenu=new l.default($("#the-cq-context-menu")),this.recordSelector=new a.default($("#the-cq-record-picker")),this.notifier=new h.default($("#the-cq-notifier")),this.recordEditor=new m.default($("#the-cq-record-editor"))}},{key:"_initListeners",value:function(){function t(){window.povSSE.close(),document.location.reload(!0)}window.povSSE.on(EVENTS.SSE_USER_LOGOUT,function(e){t()}),window.povSSE.on(EVENTS.SSE_USER_IS_WYSIWYG,function(e){!1===e.vars.wysiwyg&&t()}),$body.on(Pov.events.DOM_CHANGE_OR_READY,function(){o.default.__fromDom(c.default,"cq-blocks"),o.default.__fromDom(u.default,"wysiwyg-image"),o.default.__fromDom(d.default,"wysiwyg-rich-text"),o.default.__fromDom(f.default,"cq-sortable"),o.default.__fromDom(p.default,"cq-field-records"),o.default.cleanfromDom(),window.pov.Xdebug.fromDom()}),$body.on("input "+e.events.CHANGED,"[wysiwyg-var]",function(e){if(e.stopPropagation(),$(e.target).is("[wysiwyg-var]")){var t=new s.default($(this));t.mirror(),t.doSave()}}),$body.on("change","[wysiwyg-var][wysiwyg-data-type='file'] input[type='file']",function(){new g.CqFieldUpload($(this).closest("[wysiwyg-var][wysiwyg-data-type='file']"))})}}]),e}();t.default=y,y.events={CHANGED:"WYSIWYG_EVENT_CHANGED"}},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o={emitDelay:10,strictMode:!1},r=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?o:arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=void 0,i=void 0;n=t.hasOwnProperty("emitDelay")?t.emitDelay:o.emitDelay,this._emitDelay=n,i=t.hasOwnProperty("strictMode")?t.strictMode:o.strictMode,this._strictMode=i,this._listeners={},this.events=[]}return i(e,[{key:"_addListenner",value:function(e,t,n){if("function"!=typeof t)throw TypeError("listener must be a function");-1===this.events.indexOf(e)?(this._listeners[e]=[{once:n,fn:t}],this.events.push(e)):this._listeners[e].push({once:n,fn:t})}},{key:"on",value:function(e,t){this._addListenner(e,t,!1)}},{key:"once",value:function(e,t){this._addListenner(e,t,!0)}},{key:"off",value:function(e,t){var n,i,o=this,r=this.events.indexOf(e);e&&-1!==r&&(t?(n=[],(i=o._listeners[e]).forEach(function(e,i){e.fn===t&&n.unshift(i)}),n.forEach(function(e){i.splice(e,1)}),i.length||(o.events.splice(r,1),delete o._listeners[e])):(delete this._listeners[e],this.events.splice(r,1)))}},{key:"_applyEvents",value:function(e,t){var n=this._listeners[e];if(n&&n.length){var i=[];n.forEach(function(e,n){e.fn.apply(null,t),e.once&&i.unshift(n)}),i.forEach(function(e){n.splice(e,1)})}else if(this._strictMode)throw"No listeners specified for event: "+e}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this._emitDelay?setTimeout(function(){t._applyEvents.call(t,e,i)},this._emitDelay):this._applyEvents(e,i)}},{key:"emitSync",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this._applyEvents(e,n)}},{key:"destroy",value:function(){this._listeners={},this.events=[]}}]),e}();e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$main=t,this._$nameField=t.find("input[type='text'][name='name']"),this._$step2=t.find(".js-step-2"),this._$link=t.find(".js-link"),this._$createBtns=t.find("[href='#create-record']"),this.showStep2(!1),this._initListeners()}return i(e,[{key:"_initListeners",value:function(){var e=this;e._$nameField.on("input",function(){$(this).val()?e.showStep2(!0):e.showStep2(!1)}),$(e._$nameField).on("keyup",function(t){13===t.keyCode&&(t.preventDefault(),e.create(e._$nameField.val(),$(this).attr("record-type")))}),e._$createBtns.on("click",function(t){t.preventDefault(),e.create(e._$nameField.val(),$(this).attr("record-type"))})}},{key:"showStep2",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this._$step2.css("display",""):this._$step2.css("display","none")}},{key:"create",value:function(e,t){var n=this;console.log("va créer un "+t+" qui se nomme "+e);var i={modelType:t,modelVars:{}};i.modelVars.name=e,this.loading(!0),window.pov.api.create(i,function(e){if(n.loading(!1),console.log(e),e.success){if(e.json.recordCreated.hrefRelative){var t=$("<a>Aller sur la page</a>");t.attr("href",e.json.recordCreated.hrefRelative),setTimeout(function(){t.remove()},15e3),n._$link.prepend(t)}n.reset()}else{var i=!0,o=!1,r=void 0;try{for(var s,a=e.errors[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var l=s.value;wysiwyg.notifier.notify(l,5,"danger")}}catch(l){o=!0,r=l}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}})}},{key:"reset",value:function(){this.showStep2(!1),this._$nameField.val("")}},{key:"loading",value:function(e){e?this.$main.addClass("wysiwyg-loading"):this.$main.removeClass("wysiwyg-loading")}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};var a=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"danger",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!e){var s=n(30)({theme:i,count:o,message:r});e=$(s)}var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a._count=o,a._theme=i,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destroy",value:function(){}},{key:"count",set:function(e){this._count=e,this.$main.attr("data-count",this._count)},get:function(){return this._count}},{key:"theme",set:function(e){this._theme=e,this.$main.removeClassPrefix("th-"),this.$main.addClass("th-"+this.theme)},get:function(){return this._theme}}]),t}();t.default=a,$.fn.CqTip=function(){return $(this).is("[cq-tip='init']")?$(this).data("CqTip"):new a($(this))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(0)),r=s(n(13));function s(e){return e&&e.__esModule?e:{default:e}}n(36);var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return new PerfectScrollbar(e.find(".records").get(0),{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20,suppressScrollX:!0,swipeEasing:!0}),setTimeout(function(){window.cqAdmin.ui.recordEditor.on(EVENTS.OPEN,function(){i.highlightEdited()})},100),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"$all",value:function(){return this.$main.find("[record-type]")}},{key:"setTypes",value:function(e){this.types=e,this.refreshList(e)}},{key:"refreshList",value:function(){var e=this,t=e.$main.find(".records");t.empty().append((new r.default).$main),window.pov.api.getView("cq-browse-records/records",t,{types:this.types.join(","),function:function(t){e.emit(EVENTS.CHANGED),setTimeout(function(){e.highlightEdited()},100)}})}},{key:"highlightEdited",value:function(){var e=window.cqAdmin.ui.recordEditor.currentUid;this.$all().removeClass("active"),this.$all().filter("[data-pov-vv-uid='"+e+"']").addClass("active")}},{key:"destroy",value:function(){}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(34);t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$main=$(n(35))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};n(39),n(40);var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.$container=n.$main.find(">main>.target"),n.currentUid="",new PerfectScrollbar(n.$main.find(">main").get(0),{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20,suppressScrollX:!0,swipeEasing:!0}),n.$main.on(EVENTS.SSE_DB_TRASH,function(e){i.hide()}),n.$main.on(EVENTS.SSE_DB_CHANGE,function(e){$(e.target).povRefresh()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"displayUid",value:function(e){t.loadUid(e,this.$container),this.show(),this.currentUid=e,this.emit(EVENTS.OPEN,[e])}},{key:"show",value:function(){this.$main.addClass("open")}},{key:"hide",value:function(){this.$main.removeClass("open")}}],[{key:"loadUid",value:function(e,t){return new Promise(function(n,i){t.empty();var o=$("<div></div>");t.append(o);LayoutVars.rootUrl;window.pov.api.getView("unique-instances/cq-edit-record-box/record-content",o,{uid:e},function(e){n(e)})})}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};n(46);var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.$nav=n.$main.find(">nav"),n.$content=n.$main.find(">main"),n.$footer=n.$main.find(">footer"),n._daggable=Draggable.create(e,{edgeResistance:.15,type:"x,y",throwProps:!0,trigger:i.$nav}),n.$main.on("click","[href='#hide-closest-box']",function(e){e.preventDefault(),i.close()}),new PerfectScrollbar(n.$content.get(0),{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20,suppressScrollX:!0,swipeEasing:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"close",value:function(){this.$main.hasClass("open")&&(this.$main.removeClass("open"),this.emit(EVENTS.CLOSE))}},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;wysiwyg.contextMenu.show(),this.$main.addClass("open"),this.$main.css("z-index",Draggable.zIndex++),TweenMax.fromTo(this.$main,.2,{scale:1.2,opacity:0},{scale:1,opacity:1});var n=void 0,i=void 0;e&&(n=Math.round(window.pov.utils.ratio(e,1,$(window).width()-this.width()-10,0,10))),t&&(i=Math.round(window.pov.utils.ratio(t,1,$(window).height()-this.height()-10,0,10))),TweenMax.set(this.$main,{x:n,y:i}),this.emit(EVENTS.OPEN)}}]),t}();t.default=a},function(e,t,n){var i,o;!function(r){"use strict";void 0===(o="function"==typeof(i=r)?i.call(t,n,t,e):i)||(e.exports=o)}(function(){"use strict";if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,n,i,o,r,s,a,l,c,u,d,h,f,p,m,v,g,b,y,w,E={},C=/\s+/g,k=/left|right|inline/,_="Sortable"+(new Date).getTime(),T=window,S=T.document,x=T.parseInt,A=T.setTimeout,$=T.jQuery||T.Zepto,P=T.Polymer,N=!1,O="draggable"in S.createElement("div"),D=!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&((w=S.createElement("x")).style.cssText="pointer-events:auto","auto"===w.style.pointerEvents),L=!1,M=Math.abs,B=Math.min,j=[],I=[],R=ie(function(e,t,n){if(n&&t.scroll){var i,o,r,s,u,d,h=n[_],f=t.scrollSensitivity,p=t.scrollSpeed,m=e.clientX,v=e.clientY,g=window.innerWidth,b=window.innerHeight;if(l!==n&&(a=t.scroll,l=n,c=t.scrollFn,!0===a)){a=n;do{if(a.offsetWidth<a.scrollWidth||a.offsetHeight<a.scrollHeight)break}while(a=a.parentNode)}a&&(i=a,o=a.getBoundingClientRect(),r=(M(o.right-m)<=f)-(M(o.left-m)<=f),s=(M(o.bottom-v)<=f)-(M(o.top-v)<=f)),r||s||(s=(b-v<=f)-(v<=f),((r=(g-m<=f)-(m<=f))||s)&&(i=T)),E.vx===r&&E.vy===s&&E.el===i||(E.el=i,E.vx=r,E.vy=s,clearInterval(E.pid),i&&(E.pid=setInterval(function(){if(d=s?s*p:0,u=r?r*p:0,"function"==typeof c)return c.call(h,u,d,e);i===T?T.scrollTo(T.pageXOffset+u,T.pageYOffset+d):(i.scrollTop+=d,i.scrollLeft+=u)},24)))}},30),F=function(e){function t(e,t){return void 0!==e&&!0!==e||(e=n.name),"function"==typeof e?e:function(n,i){var o=i.options.group.name;return t?e:e&&(e.join?e.indexOf(o)>-1:o==e)}}var n={},i=e.group;i&&"object"==typeof i||(i={name:i}),n.name=i.name,n.checkPull=t(i.pull,!0),n.checkPut=t(i.put),n.revertClone=i.revertClone,e.group=n};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){N={capture:!1,passive:!1}}}))}catch(e){}function q(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=t=oe({},t),e[_]=this;var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==q.supportPointer};for(var i in n)!(i in t)&&(t[i]=n[i]);for(var o in F(t),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!t.forceFallback&&O,V(e,"mousedown",this._onTapStart),V(e,"touchstart",this._onTapStart),t.supportPointer&&V(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(V(e,"dragover",this),V(e,"dragenter",this)),I.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function H(t,n){"clone"!==t.lastPullMode&&(n=!0),i&&i.state!==n&&(G(i,"display",n?"none":""),n||i.state&&(t.options.group.revertClone?(o.insertBefore(i,r),t._animate(e,i)):o.insertBefore(i,e)),i.state=n)}function U(e,t,n){if(e){n=n||S;do{if(">*"===t&&e.parentNode===n||ne(e,t))return e}while(e=K(e))}return null}function K(e){var t=e.host;return t&&t.nodeType?t:e.parentNode}function V(e,t,n){e.addEventListener(t,n,N)}function z(e,t,n){e.removeEventListener(t,n,N)}function W(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(C," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(C," ")}}function G(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return S.defaultView&&S.defaultView.getComputedStyle?n=S.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in i||(t="-webkit-"+t),i[t]=n+("string"==typeof n?"":"px")}}function Y(e,t,n){if(e){var i=e.getElementsByTagName(t),o=0,r=i.length;if(n)for(;o<r;o++)n(i[o],o);return i}return[]}function X(e,t,n,o,r,s,a,l){e=e||t[_];var c=S.createEvent("Event"),u=e.options,d="on"+n.charAt(0).toUpperCase()+n.substr(1);c.initEvent(n,!0,!0),c.to=r||t,c.from=s||t,c.item=o||t,c.clone=i,c.oldIndex=a,c.newIndex=l,t.dispatchEvent(c),u[d]&&u[d].call(e,c)}function Q(e,t,n,i,o,r,s,a){var l,c,u=e[_],d=u.options.onMove;return(l=S.createEvent("Event")).initEvent("move",!0,!0),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=o||t,l.relatedRect=r||t.getBoundingClientRect(),l.willInsertAfter=a,e.dispatchEvent(l),d&&(c=d.call(u,l,s)),c}function J(e){e.draggable=!1}function Z(){L=!1}function ee(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function te(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"===e.nodeName.toUpperCase()||">*"!==t&&!ne(e,t)||n++;return n}function ne(e,t){if(e){var n=(t=t.split(".")).shift().toUpperCase(),i=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");return!(""!==n&&e.nodeName.toUpperCase()!=n||t.length&&((" "+e.className+" ").match(i)||[]).length!=t.length)}return!1}function ie(e,t){var n,i;return function(){void 0===n&&(n=arguments,i=this,A(function(){1===n.length?e.call(i,n[0]):e.apply(i,n),n=void 0},t))}}function oe(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function re(e){return P&&P.dom?P.dom(e).cloneNode(!0):$?$(e).clone(!0)[0]:e.cloneNode(!0)}function se(e){return A(e,0)}function ae(e){return clearTimeout(e)}return q.prototype={constructor:q,_onTapStart:function(t){var n,i=this,o=this.el,r=this.options,a=r.preventOnFilter,l=t.type,c=t.touches&&t.touches[0],u=(c||t).target,d=t.target.shadowRoot&&t.path&&t.path[0]||u,h=r.filter;if(function(e){var t=e.getElementsByTagName("input"),n=t.length;for(;n--;){var i=t[n];i.checked&&j.push(i)}}(o),!e&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||r.disabled)&&!d.isContentEditable&&(u=U(u,r.draggable,o))&&s!==u){if(n=te(u,r.draggable),"function"==typeof h){if(h.call(this,t,u,this))return X(i,d,"filter",u,o,o,n),void(a&&t.preventDefault())}else if(h&&(h=h.split(",").some(function(e){if(e=U(d,e.trim(),o))return X(i,e,"filter",u,o,o,n),!0})))return void(a&&t.preventDefault());r.handle&&!U(d,r.handle,o)||this._prepareDragStart(t,c,u,n)}},_prepareDragStart:function(n,i,a,l){var c,u=this,d=u.el,h=u.options,p=d.ownerDocument;a&&!e&&a.parentNode===d&&(g=n,o=d,t=(e=a).parentNode,r=e.nextSibling,s=a,m=h.group,f=l,this._lastX=(i||n).clientX,this._lastY=(i||n).clientY,e.style["will-change"]="all",c=function(){u._disableDelayedDrag(),e.draggable=u.nativeDraggable,W(e,h.chosenClass,!0),u._triggerDragStart(n,i),X(u,o,"choose",e,o,o,f)},h.ignore.split(",").forEach(function(t){Y(e,t.trim(),J)}),V(p,"mouseup",u._onDrop),V(p,"touchend",u._onDrop),V(p,"touchcancel",u._onDrop),V(p,"selectstart",u),h.supportPointer&&V(p,"pointercancel",u._onDrop),h.delay?(V(p,"mouseup",u._disableDelayedDrag),V(p,"touchend",u._disableDelayedDrag),V(p,"touchcancel",u._disableDelayedDrag),V(p,"mousemove",u._disableDelayedDrag),V(p,"touchmove",u._disableDelayedDrag),h.supportPointer&&V(p,"pointermove",u._disableDelayedDrag),u._dragStartTimer=A(c,h.delay)):c())},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),z(e,"mouseup",this._disableDelayedDrag),z(e,"touchend",this._disableDelayedDrag),z(e,"touchcancel",this._disableDelayedDrag),z(e,"mousemove",this._disableDelayedDrag),z(e,"touchmove",this._disableDelayedDrag),z(e,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(t,n){(n=n||("touch"==t.pointerType?t:null))?(g={target:e,clientX:n.clientX,clientY:n.clientY},this._onDragStart(g,"touch")):this.nativeDraggable?(V(e,"dragend",this),V(o,"dragstart",this._onDragStart)):this._onDragStart(g,!0);try{S.selection?se(function(){S.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(){if(o&&e){var t=this.options;W(e,t.ghostClass,!0),W(e,t.dragClass,!1),q.active=this,X(this,o,"start",e,o,o,f)}else this._nulling()},_emulateDragOver:function(){if(b){if(this._lastX===b.clientX&&this._lastY===b.clientY)return;this._lastX=b.clientX,this._lastY=b.clientY,D||G(n,"display","none");var e=S.elementFromPoint(b.clientX,b.clientY),t=e,i=I.length;if(e&&e.shadowRoot&&(t=e=e.shadowRoot.elementFromPoint(b.clientX,b.clientY)),t)do{if(t[_]){for(;i--;)I[i]({clientX:b.clientX,clientY:b.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);D||G(n,"display","")}},_onTouchMove:function(e){if(g){var t=this.options,i=t.fallbackTolerance,o=t.fallbackOffset,r=e.touches?e.touches[0]:e,s=r.clientX-g.clientX+o.x,a=r.clientY-g.clientY+o.y,l=e.touches?"translate3d("+s+"px,"+a+"px,0)":"translate("+s+"px,"+a+"px)";if(!q.active){if(i&&B(M(r.clientX-this._lastX),M(r.clientY-this._lastY))<i)return;this._dragStarted()}this._appendGhost(),y=!0,b=r,G(n,"webkitTransform",l),G(n,"mozTransform",l),G(n,"msTransform",l),G(n,"transform",l),e.preventDefault()}},_appendGhost:function(){if(!n){var t,i=e.getBoundingClientRect(),r=G(e),s=this.options;W(n=e.cloneNode(!0),s.ghostClass,!1),W(n,s.fallbackClass,!0),W(n,s.dragClass,!0),G(n,"top",i.top-x(r.marginTop,10)),G(n,"left",i.left-x(r.marginLeft,10)),G(n,"width",i.width),G(n,"height",i.height),G(n,"opacity","0.8"),G(n,"position","fixed"),G(n,"zIndex","100000"),G(n,"pointerEvents","none"),s.fallbackOnBody&&S.body.appendChild(n)||o.appendChild(n),t=n.getBoundingClientRect(),G(n,"width",2*i.width-t.width),G(n,"height",2*i.height-t.height)}},_onDragStart:function(t,n){var r=this,s=t.dataTransfer,a=r.options;r._offUpEvents(),m.checkPull(r,r,e,t)&&((i=re(e)).draggable=!1,i.style["will-change"]="",G(i,"display","none"),W(i,r.options.chosenClass,!1),r._cloneId=se(function(){o.insertBefore(i,e),X(r,o,"clone",e)})),W(e,a.dragClass,!0),n?("touch"===n?(V(S,"touchmove",r._onTouchMove),V(S,"touchend",r._onDrop),V(S,"touchcancel",r._onDrop),a.supportPointer&&(V(S,"pointermove",r._onTouchMove),V(S,"pointerup",r._onDrop))):(V(S,"mousemove",r._onTouchMove),V(S,"mouseup",r._onDrop)),r._loopId=setInterval(r._emulateDragOver,50)):(s&&(s.effectAllowed="move",a.setData&&a.setData.call(r,s,e)),V(S,"drop",r),r._dragStartId=se(r._dragStarted))},_onDragOver:function(s){var a,l,c,f,p=this.el,g=this.options,b=g.group,w=q.active,E=m===b,C=!1,T=g.sort;if(void 0!==s.preventDefault&&(s.preventDefault(),!g.dragoverBubble&&s.stopPropagation()),!e.animated&&(y=!0,w&&!g.disabled&&(E?T||(f=!o.contains(e)):v===this||(w.lastPullMode=m.checkPull(this,w,e,s))&&b.checkPut(this,w,e,s))&&(void 0===s.rootEl||s.rootEl===this.el))){if(R(s,g,this.el),L)return;if(a=U(s.target,g.draggable,p),l=e.getBoundingClientRect(),v!==this&&(v=this,C=!0),f)return H(w,!0),t=o,void(i||r?o.insertBefore(e,i||r):T||o.appendChild(e));if(0===p.children.length||p.children[0]===n||p===s.target&&function(e,t){var n=e.lastElementChild.getBoundingClientRect();return t.clientY-(n.top+n.height)>5||t.clientX-(n.left+n.width)>5}(p,s)){if(0!==p.children.length&&p.children[0]!==n&&p===s.target&&(a=p.lastElementChild),a){if(a.animated)return;c=a.getBoundingClientRect()}H(w,E),!1!==Q(o,p,e,l,a,c,s)&&(e.contains(p)||(p.appendChild(e),t=p),this._animate(l,e),a&&this._animate(c,a))}else if(a&&!a.animated&&a!==e&&void 0!==a.parentNode[_]){u!==a&&(u=a,d=G(a),h=G(a.parentNode));var S=(c=a.getBoundingClientRect()).right-c.left,x=c.bottom-c.top,$=k.test(d.cssFloat+d.display)||"flex"==h.display&&0===h["flex-direction"].indexOf("row"),P=a.offsetWidth>e.offsetWidth,N=a.offsetHeight>e.offsetHeight,O=($?(s.clientX-c.left)/S:(s.clientY-c.top)/x)>.5,D=a.nextElementSibling,M=!1;if($){var B=e.offsetTop,j=a.offsetTop;M=B===j?a.previousElementSibling===e&&!P||O&&P:a.previousElementSibling===e||e.previousElementSibling===a?(s.clientY-c.top)/x>.5:j>B}else C||(M=D!==e&&!N||O&&N);var I=Q(o,p,e,l,a,c,s,M);!1!==I&&(1!==I&&-1!==I||(M=1===I),L=!0,A(Z,30),H(w,E),e.contains(p)||(M&&!D?p.appendChild(e):a.parentNode.insertBefore(e,M?D:a)),t=e.parentNode,this._animate(l,e),this._animate(c,a))}}},_animate:function(e,t){var n=this.options.animation;if(n){var i=t.getBoundingClientRect();1===e.nodeType&&(e=e.getBoundingClientRect()),G(t,"transition","none"),G(t,"transform","translate3d("+(e.left-i.left)+"px,"+(e.top-i.top)+"px,0)"),t.offsetWidth,G(t,"transition","all "+n+"ms"),G(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=A(function(){G(t,"transition",""),G(t,"transform",""),t.animated=!1},n)}},_offUpEvents:function(){var e=this.el.ownerDocument;z(S,"touchmove",this._onTouchMove),z(S,"pointermove",this._onTouchMove),z(e,"mouseup",this._onDrop),z(e,"touchend",this._onDrop),z(e,"pointerup",this._onDrop),z(e,"touchcancel",this._onDrop),z(e,"pointercancel",this._onDrop),z(e,"selectstart",this)},_onDrop:function(s){var a=this.el,l=this.options;clearInterval(this._loopId),clearInterval(E.pid),clearTimeout(this._dragStartTimer),ae(this._cloneId),ae(this._dragStartId),z(S,"mouseover",this),z(S,"mousemove",this._onTouchMove),this.nativeDraggable&&(z(S,"drop",this),z(a,"dragstart",this._onDragStart)),this._offUpEvents(),s&&(y&&(s.preventDefault(),!l.dropBubble&&s.stopPropagation()),n&&n.parentNode&&n.parentNode.removeChild(n),o!==t&&"clone"===q.active.lastPullMode||i&&i.parentNode&&i.parentNode.removeChild(i),e&&(this.nativeDraggable&&z(e,"dragend",this),J(e),e.style["will-change"]="",W(e,this.options.ghostClass,!1),W(e,this.options.chosenClass,!1),X(this,o,"unchoose",e,t,o,f),o!==t?(p=te(e,l.draggable))>=0&&(X(null,t,"add",e,t,o,f,p),X(this,o,"remove",e,t,o,f,p),X(null,t,"sort",e,t,o,f,p),X(this,o,"sort",e,t,o,f,p)):e.nextSibling!==r&&(p=te(e,l.draggable))>=0&&(X(this,o,"update",e,t,o,f,p),X(this,o,"sort",e,t,o,f,p)),q.active&&(null!=p&&-1!==p||(p=f),X(this,o,"end",e,t,o,f,p),this.save()))),this._nulling()},_nulling:function(){o=e=t=n=r=i=s=a=l=g=b=y=p=u=d=v=m=q.active=null,j.forEach(function(e){e.checked=!0}),j.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragover":case"dragenter":e&&(this._onDragOver(t),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.preventDefault()}(t));break;case"mouseover":this._onDrop(t);break;case"selectstart":t.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,i=0,o=n.length,r=this.options;i<o;i++)U(e=n[i],r.draggable,this.el)&&t.push(e.getAttribute(r.dataIdAttr)||ee(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,i){var o=n.children[i];U(o,this.options.draggable,n)&&(t[e]=o)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return U(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];n[e]=t,"group"===e&&F(n)},destroy:function(){var e=this.el;e[_]=null,z(e,"mousedown",this._onTapStart),z(e,"touchstart",this._onTapStart),z(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(z(e,"dragover",this),z(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),I.splice(I.indexOf(this._onDragOver),1),this._onDrop(),this.el=e=null}},V(S,"touchmove",function(e){q.active&&e.preventDefault()}),q.utils={on:V,off:z,css:G,find:Y,is:function(e,t){return!!U(e,t,e)},extend:oe,throttle:ie,closest:U,toggleClass:W,clone:re,index:te,nextTick:se,cancelNextTick:ae},q.create=function(e,t){return new q(e,t)},q.version="1.7.0",q})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(9),s=(i=r)&&i.__esModule?i:{default:i};n(56);var a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.$main=$("<div cq-block>...</div>"),i.itemKey="key_"+(new Date).getTime()+"_"+Math.round(1e6*Math.random()),i.uid=n.field.type+"-"+n.field.id+"."+n.field.var+"."+i.itemKey,i.blocks=n,i.$main.attr("list-item-key",i.itemKey),i.$main.attr("list-item-path",e),i.$main.attr("data-pov-vv-uid",i.uid),i.$main.attr("data-pov-v-path",e),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"refresh",value:function(){var e=this;return new Promise(function(t,n){e.$main.povRefresh(function(n){e.$main=n,t()})})}},{key:"setTargetUid",value:function(e){var t=this;return new Promise(function(n,i){var o={};o.modelType=t.blocks.field.type,o.modelId=t.blocks.field.id,o.modelVars={},o.modelVars[t.uid+".targetUid"]=e,window.pov.api.save(o,function(){n()})})}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.$svg=$('<svg class="wysiwyg-progress-circle" width="60" height="60" viewPort="0 0 60 60">\n  <circle r="25" cx="30" cy="30" fill="transparent" stroke-dasharray="0" stroke-dashoffset="0"></circle>\n  <circle class="progress" r="25" cx="30" cy="30" fill="transparent" stroke-dasharray="0" stroke-dashoffset="0"></circle>\n</svg>'),n.$progress=n.$svg.find(".progress"),n.$circles=n.$svg.find("circle"),n._initAccordingRadius(),n.w=60,n.h=60,e&&(wysiwyg.contextMenu.$main.append(n.$svg),n.$svg.css("position","absolute"),n.$svg.css("z-index","100000"),n.setPercent(0),n.loop=setInterval(function(){if(i.isInDom()){var e=i.$main.get(0).getBoundingClientRect();TweenMax.to(i.$svg,0,{x:e.x+i.$main.width()-i.w-30,y:e.y+30})}else i.destroy()},100)),n.loop=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"_initAccordingRadius",value:function(){var e=this.$circles.attr("r"),t=2*Math.PI*e;this.$circles.attr("stroke-dasharray",t)}},{key:"setPercent",value:function(e){e=Math.min(e,98),e=Math.max(e,2);var t=this.$progress.attr("r"),n=(100-e)/100*(Math.PI*(2*t));this.$progress.css({strokeDashoffset:n})}},{key:"destroy",value:function(){this.$svg&&this.$svg.length&&this.$svg.remove(),this.loop&&clearInterval(this.loop)}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(68),s=(i=r)&&i.__esModule?i:{default:i};n(69);var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.$bar=e.find(".bar"),n._updateDisplay(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"_updateDisplay",value:function(){this.$bar.width(window.pov.utils.ratio(this._value,this.max,100,this.min,0)+"%")}},{key:"progress",set:function(e){this._value=e,this._updateDisplay()},get:function(){return this._value}}]),t}();t.default=a},,,,,,,function(e,t,n){"use strict";var i,o=n(8),r=(i=o)&&i.__esModule?i:{default:i};n(82),n(83),Pov.onBodyReady(function(){console.log("ready (wysiwyg)"),window.wysiwyg=new r.default})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=f(n(10)),r=f(n(28)),s=f(n(11)),a=f(n(33)),l=f(n(37)),c=f(n(14)),u=f(n(41)),d=f(n(0)),h=f(n(13));function f(e){return e&&e.__esModule?e:{default:e}}n(43);var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this;this.$main=t,this.$extension=this.$main.find(">.extension"),this.$pageSection=this.$main.find("[cq-panel-is-section='page']"),this.$createSection=this.$main.find("[cq-panel-is-section='create']"),this.$browseSection=this.$main.find("[cq-panel-is-section='browse']"),this.panels=new r.default(t,"bigMenuMainSections"),this.panels.getActiveName()&&this.open(this.panels.getActiveName(),!0),this.panels.on(EVENTS.SELECT,function(e){switch(e){case"browse":n.browse.active(),n.showExtension();break;case"user":n.usersSection.active(),n.showExtension();break;default:n.hideExtension(),window.wysiwyg.recordEditor.hide()}}),new PerfectScrollbar(t.find("main").get(0),{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20,suppressScrollX:!0,swipeEasing:!0}),this.usersSection=new a.default(n.$userSection(),n),this.browse=new l.default(this.$browseSection,this),new o.default(this.$createSection),d.default.__fromDom(u.default,"cq-display-control"),n.injectPageModules(),this.initListeners()}return i(e,[{key:"initListeners",value:function(){var e=this;this.$pageSection.on(EVENTS.SSE_DB_CHANGE,function(){e.refreshPageSection()}),this.$pageSection.on(Pov.events.DOM_CHANGE,function(){e.manageErrorsAndTips()}),$body.on(EVENTS.HISTORY_CHANGE_URL_LOADING,function(){e.clearPageModule()}),$body.on(EVENTS.HISTORY_CHANGE_URL_LOADED_INJECTED,function(){e.injectPageModules()}),$body.on(Pov.events.READY,function(){e.injectPageModules()})}},{key:"$userSection",value:function(){return this.$main.find("[cq-panel-is-section='user']")}},{key:"manageErrorsAndTips",value:function(){this.$pageSection.find(".js-tip-injected").remove();var e=this.$pageSection.find("[wysiwyg-field-error]");e.each(function(){var e=new s.default(null,"danger",1,$(this).attr("wysiwyg-field-error"));e.$main.addClass("js-tip-injected"),$(this).closest("fieldset").addClass("has-cq-tip").append(e.$main)}),this.panels.$sectionBtn("page").find("[cq-tip]").each(function(){$(this).CqTip().count=e.length})}},{key:"$pageSectionRefreshable",value:function(){return this.$pageSection.find("[data-pov-v-path]").first()}},{key:"refreshPageSection",value:function(){this.$pageSectionRefreshable().povRefresh()}},{key:"toggle",value:function(){console.log("toggle menu"),this.$main.toggleClass("open"),this.$main.hasClass("open")?this.open(!1):this.close()}},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"page",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;console.log("open menu"),window.wysiwyg.contextMenu&&window.wysiwyg.contextMenu.setAnchor(null),t&&(this.$main.addClass("cq-no-transition"),setTimeout(function(){n.$main.removeClass("cq-no-transition")},1e3)),this.$main.addClass("open"),e&&this.panels.show(e)}},{key:"close",value:function(){console.log("close menu"),this.$main.removeClass("open"),this.panels.hideAll(),this.hideExtension(),wysiwyg.recordEditor.hide()}},{key:"injectPageModules",value:function(){console.log("inject page module",PovHistory.currentPageInfo.uid);var e=this;c.default.loadUid(PovHistory.currentPageInfo.uid,e.$pageSection).then(function(){e.manageErrorsAndTips()})}},{key:"clearPageModule",value:function(){this.$pageSection.empty().append((new h.default).$main)}},{key:"showExtension",value:function(){this.$extension.addClass("open")}},{key:"hideExtension",value:function(){this.$extension.removeClass("open")}},{key:"setExtensionContent",value:function(e){this.$extension.empty(),this.$extension.append(e)}}]),e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(4)),r=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}n(29);var a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=i;return e.on("click","[cq-panel-section-toggle]",function(e){e.preventDefault(),r.show($(this).attr("cq-panel-section-toggle"))}),i._storage=null,r._tmpActiveName=r.$sections().filter(".section-active").attr("cq-panel-is-section"),n&&(i._storage=new o.default(n)),i.applyToUi(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),i(t,[{key:"$section",value:function(e){return this.$main.find("[cq-panel-is-section='"+e+"']")}},{key:"$sectionBtn",value:function(e){return this.$main.find("[cq-panel-section-toggle='"+e+"']")}},{key:"$sectionBtns",value:function(){return this.$main.find("[cq-panel-section-toggle]")}},{key:"$sections",value:function(){return this.$main.find("[cq-panel-is-section]")}},{key:"show",value:function(e){this._setActiveName(e);var t=this.$section(e);t.hasClass("section-active")||(t.addClass("section-active"),t.parent().scrollTop(0)),this.hideAll(),t.addClass("section-active"),this.$sectionBtn(e).addClass("section-active"),this._storage&&this._storage.setValue("active",e),this.emit(EVENTS.SELECT,e)}},{key:"hideAll",value:function(){this.$sections().removeClass("section-active"),this.$sectionBtns().removeClass("section-active"),this._storage&&this._storage.setValue("active",null)}},{key:"applyToUi",value:function(){this.show(this.getActiveName())}},{key:"getActiveName",value:function(){return this._storage?this._storage.getValue("active"):this._tmpActiveName}},{key:"_setActiveName",value:function(e){this.storage?this._storage.setValue("active",e):this._tmpActiveName=e}},{key:"destroy",value:function(){}}]),t}();t.default=a},function(e,t){},function(e,t,n){var i=n(5);e.exports=function(){var e=new i.Template({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<i cq-tip data-count="'),i.b(i.v(i.f("count",e,t,0))),i.b('" title="'),i.b(i.v(i.f("message",e,t,0))),i.b('" class="cq-th-'),i.b(i.v(i.f("theme",e,t,0))),i.b('"></i>'),i.fl()},partials:{},subs:{}},'<i cq-tip data-count="{{count}}" title="{{message}}" class="cq-th-{{theme}}"></i>',i);return e.render.apply(e,arguments)}},function(e,t,n){!function(e){var t=/\S/,n=/\"/g,i=/\n/g,o=/\r/g,r=/\\/g,s=/\u2028/,a=/\u2029/;function l(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function c(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function u(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var i=1,o=e.length;i<o;i++)if(t.charAt(n+i)!=e.charAt(i))return!1;return!0}e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(n,i){var o=n.length,r=0,s=null,a=null,d="",h=[],f=!1,p=0,m=0,v="{{",g="}}";function b(){d.length>0&&(h.push({tag:"_t",text:new String(d)}),d="")}function y(n,i){if(b(),n&&function(){for(var n=!0,i=m;i<h.length;i++)if(!(n=e.tags[h[i].tag]<e.tags._v||"_t"==h[i].tag&&null===h[i].text.match(t)))return!1;return n}())for(var o,r=m;r<h.length;r++)h[r].text&&((o=h[r+1])&&">"==o.tag&&(o.indent=h[r].text.toString()),h.splice(r,1));else i||h.push({tag:"\n"});f=!1,m=h.length}function w(e,t){var n="="+g,i=e.indexOf(n,t),o=c(e.substring(e.indexOf("=",t)+1,i)).split(" ");return v=o[0],g=o[o.length-1],i+n.length-1}for(i&&(i=i.split(" "),v=i[0],g=i[1]),p=0;p<o;p++)0==r?u(v,n,p)?(--p,b(),r=1):"\n"==n.charAt(p)?y(f):d+=n.charAt(p):1==r?(p+=v.length-1,"="==(s=(a=e.tags[n.charAt(p+1)])?n.charAt(p+1):"_v")?(p=w(n,p),r=0):(a&&p++,r=2),f=p):u(g,n,p)?(h.push({tag:s,n:c(d),otag:v,ctag:g,i:"/"==s?f-v.length:p+g.length}),d="",p+=g.length-1,r=0,"{"==s&&("}}"==g?p++:l(h[h.length-1]))):d+=n.charAt(p);return y(f,!0),h};var d={_t:!0,"\n":!0,$:!0,"/":!0};function h(e,t){for(var n=0,i=t.length;n<i;n++)if(t[n].o==e.n)return e.tag="#",!0}function f(e,t,n){for(var i=0,o=n.length;i<o;i++)if(n[i].c==e&&n[i].o==t)return!0}function p(e){var t=[];for(var n in e.partials)t.push('"'+v(n)+'":{name:"'+v(e.partials[n].name)+'", '+p(e.partials[n])+"}");return"partials: {"+t.join(",")+"}, subs: "+function(e){var t=[];for(var n in e)t.push('"'+v(n)+'": function(c,p,t,i) {'+e[n]+"}");return"{ "+t.join(",")+" }"}(e.subs)}e.stringify=function(t,n,i){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+p(t)+"}"};var m=0;function v(e){return e.replace(r,"\\\\").replace(n,'\\"').replace(i,"\\n").replace(o,"\\r").replace(s,"\\u2028").replace(a,"\\u2029")}function g(e){return~e.indexOf(".")?"d":"f"}function b(e,t){var n="<"+(t.prefix||"")+e.n+m++;return t.partials[n]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+v(n)+'",c,p,"'+(e.indent||"")+'"));',n}function y(e,t){t.code+="t.b(t.t(t."+g(e.n)+'("'+v(e.n)+'",c,p,0)));'}function w(e){return"t.b("+e+");"}e.generate=function(t,n,i){m=0;var o={code:"",subs:{},partials:{}};return e.walk(t,o),i.asString?this.stringify(o,n,i):this.makeTemplate(o,n,i)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,n){var i=this.makePartials(e);return i.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(i,t,this,n)},e.makePartials=function(e){var t,n={subs:{},partials:e.partials,name:e.name};for(t in n.partials)n.partials[t]=this.makePartials(n.partials[t]);for(t in e.subs)n.subs[t]=new Function("c","p","t","i",e.subs[t]);return n},e.codegen={"#":function(t,n){n.code+="if(t.s(t."+g(t.n)+'("'+v(t.n)+'",c,p,1),c,p,0,'+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){t.rs(c,p,function(c,p,t){',e.walk(t.nodes,n),n.code+="});c.pop();}"},"^":function(t,n){n.code+="if(!t.s(t."+g(t.n)+'("'+v(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,n),n.code+="};"},">":b,"<":function(t,n){var i={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,i);var o=n.partials[b(t,n)];o.subs=i.subs,o.partials=i.partials},$:function(t,n){var i={subs:{},code:"",partials:n.partials,prefix:t.n};e.walk(t.nodes,i),n.subs[t.n]=i.code,n.inPartial||(n.code+='t.sub("'+v(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=w('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+g(e.n)+'("'+v(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=w('"'+v(e.text)+'"')},"{":y,"&":y},e.walk=function(t,n){for(var i,o=0,r=t.length;o<r;o++)(i=e.codegen[t[o].tag])&&i(t[o],n);return n},e.parse=function(t,n,i){return function t(n,i,o,r){var s,a=[],l=null,c=null;for(s=o[o.length-1];n.length>0;){if(c=n.shift(),s&&"<"==s.tag&&!(c.tag in d))throw new Error("Illegal content in < super tag.");if(e.tags[c.tag]<=e.tags.$||h(c,r))o.push(c),c.nodes=t(n,c.tag,o,r);else{if("/"==c.tag){if(0===o.length)throw new Error("Closing tag without opener: /"+c.n);if(l=o.pop(),c.n!=l.n&&!f(c.n,l.n,r))throw new Error("Nesting error: "+l.n+" vs. "+c.n);return l.end=c.i,a}"\n"==c.tag&&(c.last=0==n.length||"\n"==n[0].tag)}a.push(c)}if(o.length>0)throw new Error("missing closing tag: "+o.pop().n);return a}(t,0,[],(i=i||{}).sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,n){n=n||{};var i=e.cacheKey(t,n),o=this.cache[i];if(o){var r=o.partials;for(var s in r)delete r[s].instance;return o}return o=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[i]=o}}(t)},function(e,t,n){!function(e){function t(e,t,n){var i;return t&&"object"==typeof t&&(void 0!==t[e]?i=t[e]:n&&t.get&&"function"==typeof t.get&&(i=t.get(e))),i}e.Template=function(e,t,n,i){e=e||{},this.r=e.code||this.r,this.c=n,this.options=i||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.buf=""},e.Template.prototype={r:function(e,t,n){return""},v:function(e){return e=l(e),a.test(e)?e.replace(n,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(r,"&#39;").replace(s,"&quot;"):e},t:l,render:function(e,t,n){return this.ri([e],t||{},n)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],i=t[n.name];if(n.instance&&n.base==i)return n.instance;if("string"==typeof i){if(!this.c)throw new Error("No compiler available.");i=this.c.compile(i,this.options)}if(!i)return null;if(this.partials[e].base=i,n.subs){for(key in t.stackText||(t.stackText={}),n.subs)t.stackText[key]||(t.stackText[key]=void 0!==this.activeSub&&t.stackText[this.activeSub]?t.stackText[this.activeSub]:this.text);i=function(e,t,n,i,o,r){function s(){}function a(){}var l;s.prototype=e,a.prototype=e.subs;var c=new s;for(l in c.subs=new a,c.subsText={},c.buf="",i=i||{},c.stackSubs=i,c.subsText=r,t)i[l]||(i[l]=t[l]);for(l in i)c.subs[l]=i[l];for(l in o=o||{},c.stackPartials=o,n)o[l]||(o[l]=n[l]);for(l in o)c.partials[l]=o[l];return c}(i,n.subs,n.partials,this.stackSubs,this.stackPartials,t.stackText)}return this.partials[e].instance=i,i},rp:function(e,t,n,i){var o=this.ep(e,n);return o?o.ri(t,n,i):""},rs:function(e,t,n){var i=e[e.length-1];if(c(i))for(var o=0;o<i.length;o++)e.push(i[o]),n(e,t,this),e.pop();else n(e,t,this)},s:function(e,t,n,i,o,r,s){var a;return(!c(e)||0!==e.length)&&("function"==typeof e&&(e=this.ms(e,t,n,i,o,r,s)),a=!!e,!i&&a&&t&&t.push("object"==typeof e?e:t[t.length-1]),a)},d:function(e,n,i,o){var r,s=e.split("."),a=this.f(s[0],n,i,o),l=this.options.modelGet,u=null;if("."===e&&c(n[n.length-2]))a=n[n.length-1];else for(var d=1;d<s.length;d++)void 0!==(r=t(s[d],a,l))?(u=a,a=r):a="";return!(o&&!a)&&(o||"function"!=typeof a||(n.push(u),a=this.mv(a,n,i),n.pop()),a)},f:function(e,n,i,o){for(var r=!1,s=!1,a=this.options.modelGet,l=n.length-1;l>=0;l--)if(void 0!==(r=t(e,n[l],a))){s=!0;break}return s?(o||"function"!=typeof r||(r=this.mv(r,n,i)),r):!o&&""},ls:function(e,t,n,i,o){var r=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(l(e.call(t,i)),t,n)),this.options.delimiters=r,!1},ct:function(e,t,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ms:function(e,t,n,i,o,r,s){var a,l=t[t.length-1],c=e.call(l);return"function"==typeof c?!!i||(a=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,l,n,a.substring(o,r),s)):c},mv:function(e,t,n){var i=t[t.length-1],o=e.call(i);return"function"==typeof o?this.ct(l(o.call(i)),i,n):o},sub:function(e,t,n,i){var o=this.subs[e];o&&(this.activeSub=e,o(t,n,this,i),this.activeSub=!1)}};var n=/&/g,i=/</g,o=/>/g,r=/\'/g,s=/\"/g,a=/[&<>\"\']/;function l(e){return String(null===e||void 0===e?"":e)}var c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}(t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(12)),r=s(n(10));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=this;this.$main=t,this.bigMenu=n,this.recordsList=new o.default(t.find("[cq-browse-records-list]")),this.recordsList.setTypes(["user"]),this.recordsList.on(EVENTS.CHANGED,function(){i.updateTips()}),this.recordCreator=new r.default(this.$main.find("[cq-new-record]")),window.povSSE.on(EVENTS.SSE_USER_CHANGE,function(e){i.recordsList.refreshList()})}return i(e,[{key:"updateTips",value:function(){var e=this;setTimeout(function(){var t=0;e.recordsList.$main.find("[cq-tip].cq-th-danger").each(function(){$(this).attr("data-count")>0&&t++}),e.bigMenu.panels.$sectionBtn("user").find("[cq-tip]").each(function(){$(this).CqTip().count=t})},100)}},{key:"active",value:function(){this.bigMenu.setExtensionContent(this.recordsList.$main)}}]),e}();t.default=a},function(e,t){},function(e,t){e.exports='<div class="cq-loading-dots">\r\n    <i class="a"></i>\r\n    <i class="b"></i>\r\n    <i class="c"></i>\r\n</div>'},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(4)),s=a(n(12));function a(e){return e&&e.__esModule?e:{default:e}}n(38);var l=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o=i;return i.bigMenu=n,i.storage=new r.default("browseRecords"),i.typesSelected=[],povSSE.on(EVENTS.SSE_DB_COUNT_CHANGE,function(){o.refreshContent()}),i.$list=null,i.recordsList=null,i.__init(e),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"__init",value:function(e){var t=this;if(this.$main=e,this.$list=this.$main.find("[cq-browse-records-list]"),this.recordsList=new s.default(this.$list),this.$types().on("change",function(){var e=[];t.$types().filter(":checked").each(function(){e.push($(this).val())}),t.setTypes(e)}),t.storage.getValue("typesSelected")){var n=[],i=!0,o=!1,r=void 0;try{for(var a,l=t.storage.getValue("typesSelected")[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var c=a.value;this.$types().filter("[value='"+c+"']").prop("checked",!0),n.push(c)}}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}this.setTypes(n)}}},{key:"refreshContent",value:function(){var e=this;e.$main.povRefresh(function(t){e.__init(t),e.bigMenu.panels.applyToUi()})}},{key:"$types",value:function(){return this.$main.find(".js-is-record-type")}},{key:"setTypes",value:function(e){this.typesSelected=window.pov.utils.arrayUnique(e),this.storage.setValue("typesSelected",this.typesSelected),this.updateUi()}},{key:"updateUi",value:function(){var e=this;this.timeOutUpdate&&clearTimeout(this.timeOutUpdate),this.timeOutUpdate=setTimeout(function(){e.recordsList.setTypes(e.typesSelected)},10)}},{key:"active",value:function(){this.bigMenu.setExtensionContent(this.$list)}}]),t}();t.default=l},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=r(n(4));function r(e){return e&&e.__esModule?e:{default:e}}n(42);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=e.find("input[type='checkbox']"),r=new o.default("cq-is-display");function s(e,t){t?($body.attr("cq-display-"+e,"1"),r.setValue(e,!0)):($body.removeAttr("cq-display-"+e),r.setValue(e,!1))}return i.each(function(){var e=$(this).attr("value");r.getValue(e)?(s(e,!0),$(this).prop("checked",!0)):s(e,!1)}),i.on("change",function(){s($(this).attr("value"),$(this).is(":checked"))}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),t}();t.default=s},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"format",value:function(e,t){switch(t){case"STRING_FORMAT_NO_HTML_SINGLE_LINE":case"FORMAT_NO_HTML_MULTI_LINE":var n=document.createElement("div");return n.innerHTML=e,e=n.textContent||n.innerText||"";default:return e}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(15),s=(i=r)&&i.__esModule?i:{default:i};var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.multiple=!1,n.recordsTypes=[],n.$ok=n.$main.find(".js-btn-ok"),n.$cancel=n.$main.find(".js-btn-cancel"),n.$ok.on("click",function(){i._onOk()}),n.$cancel.on("click",function(){i.close()}),povSSE.on(EVENTS.SSE_DB_COUNT_CHANGE,function(){i.$list().povRefresh(function(){i.setMultiple(i.multiple),i.setRecordsTypes(i.recordsTypes)},!0)}),n.on(EVENTS.CLOSE,function(){i._onCancel()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"$list",value:function(){return this.$main.find(".js-list")}},{key:"resetSelection",value:function(){this._$allrecords().prop("checked",!1)}},{key:"reset",value:function(){this.resetSelection()}},{key:"_onCancel",value:function(){console.log("onCancel original")}},{key:"_onOk",value:function(){console.log("onSelected original")}},{key:"_$selected",value:function(){return this._$allrecords().filter(":checked")}},{key:"_$allrecords",value:function(){return this.$main.find("input.js-is-record-checker[value]")}},{key:"_getSelectedUids",value:function(){var e=[];return this._$selected().each(function(){e.push($(this).prop("value"))}),e}},{key:"_setSelectedUids",value:function(e){this._$allrecords().prop("checked",!1);var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;console.log(s),this.$main.find("input.js-is-record-checker[value='"+s+"']").prop("checked",!0)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"_setDisabledUids",value:function(e){this._$allrecords().prop("disabled",!1);var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;console.log(s),this.$main.find("input.js-is-record-checker[value='"+s+"']").prop("disabled",!0)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"setMultiple",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.multiple=e,e?this._$allrecords().attr("type","checkbox"):this._$allrecords().attr("type","radio")}},{key:"setRecordsTypes",value:function(e){this.recordsTypes=e;var t=this.$content.find("[record-type]");e?(t.css("display","none"),"string"==typeof e&&(e=e.split(",")),Array.isArray(e)||(e=[e]),$.each(e,function(e,n){t.filter("[record-type='"+n+"']").css("display","")})):t.css("display","")}},{key:"getUids",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=this;return i.open(),"string"==typeof n&&(n=n.split(",")),i._setDisabledUids(n),this.setMultiple(e),this.setRecordsTypes(t),new Promise(function(e,t){i._onOk=function(){i.close();var t=i._getSelectedUids(),n=i.$recordsPreviews(i._getSelectedUids());console.log(t,n),e(t,n),i.reset()},i._onCancel=function(){i.close(),t()}})}},{key:"$recordPreview",value:function(e){return this.$main.find("[data-pov-vv-uid='"+e+"']").clone(!1)}},{key:"$recordsPreviews",value:function(e){var t=[],n=!0,i=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value;t.push(this.$recordPreview(a))}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return $(t).map(function(){return this.toArray()})}},{key:"getRecordUrl",value:function(e){return LayoutVars.rootUrl+"/permalink-uid/"+e}}]),t}();t.default=a},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=r(n(15));r(n(48));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this;function i(e,t){e.css("display","").on("click",function(e){e.preventDefault(),t()})}this.$main=t,this.$anchor=null,this.addIsBeforeAnchor=!1,this.$anchorBox=null,this.$selection=t.find("#the-cq-selection"),this.$menu=t.find(".is-menu"),this.$menuAdd=t.find(".is-menu-add"),this.menuAdd=this.$menuAdd.CqBtnGroup(),this.menu=this.$menu.CqBtnGroup(),this.$menuAndSelection=t.find("#menu-and-selection"),this.contextMenuPosition="tr",this.horizontal=!1,this.isInList=!1,this.loopInterval=setInterval(function(){n._loop()},20),this.$disabler=this.$main.find(".disabler"),this.$configBox=this.$main.find("#config-box"),this.configBox=new o.default(this.$configBox),this.$popinBoxes=this.$main.find("[cq-popin-box]"),this.$main.on("click","[href='#hide-stuff']",function(e){e.preventDefault(),n._hideStuff()}),this.btns={$up:t.find("[href='#up']"),$left:t.find("[href='#left']"),$down:t.find("[href='#down']"),$right:t.find("[href='#right']"),$trash:t.find("[href='#trash']"),$cog:t.find("[href='#cog']"),$plus:t.find("[href='#plus']"),$plusUpload:t.find("[href='#plus-upload']"),$upload:t.find("[href='#upload']"),before:function(e){n.horizontal?i(this.$left,e):i(this.$up,e)},after:function(e){n.horizontal?i(this.$right,e):i(this.$down,e)},trash:function(e){i(this.$trash,e)},cog:function(e){i(this.$cog,e)},plus:function(e){this.$plus.css("display","").on("click",function(t){t.preventDefault(),e(n.addIsBeforeAnchor)})},plusUpload:function(e){this.$plusUpload().css("display","").on("change",function(t){t.preventDefault(),e(n.addIsBeforeAnchor,t.target.files)})},plusUploadImages:function(e){this.$plusUploadImagesOnly().css("display","").on("change",function(t){t.preventDefault(),e(n.addIsBeforeAnchor,t.target.files)})},upload:function(e){i(n.addIsBeforeAnchor,this.$upload)},_setSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";return n.$menu.attr("size",e),n.$menuAdd.attr("size",e),this},$all:n.$menu.find("a[href*='#']").add(n.$menuAdd.find("a[href*='#']")),reset:function(){return n.btns.$all.off("click"),n.btns.$all.off("change"),n.btns.$all.off("input"),n.btns.$all.css("display","none"),n.btns.$all.find("input[type='file']").val(""),n.btns.$all.find("input[type='file']").removeAttr("accept"),n.btns.$all.removeClass("first"),n.btns.$all.removeClass("last"),n},$plusUploadImagesOnly:function(){return n.btns.$plusUpload.find("input").attr("accept","image/*"),n.btns.$plusUpload},$uploadImagesOnly:function(){return n.btns.$upload.find("input").attr("accept","image/*"),n.btns.$upload}},this.btns.reset(),this._hideStuff(),this.hide()}return i(e,[{key:"_hideStuff",value:function(){this.$popinBoxes.removeClass("open"),this.$disabler.css("display","none")}},{key:"_loop",value:function(){var e=this;if(e.visible&&e.$anchor){var t=e.$anchor.get(0).getBoundingClientRect();if(!(t.left-30<STAGE.mouseX&&t.right+30>STAGE.mouseX&&t.top-30<STAGE.mouseY&&t.bottom+30>STAGE.mouseY))return void this.setAnchor(null);if(e.$anchorBox&&e.$anchorBox.get(0)){var n=e.$anchorBox.get(0).getBoundingClientRect();e.$menuAndSelection.css("clip","rect("+n.top+"px, "+n.right+"px, "+n.bottom+"px, "+n.left+"px)")}else e.$menuAndSelection.css("clip","");TweenMax.to(e.$selection,0,{x:t.left-0,y:t.top-0,width:t.width+0,height:t.height+0,roundProps:"x,y,width,height"});var i=void 0,o=void 0,r=void 0,s=void 0;e.isInList&&(e.horizontal?(s=t.top+t.height/2-e.$menuAdd.height()/2,STAGE.mouseX<t.left+t.width/2?(e.addIsBeforeAnchor=!0,r=t.left-e.$menuAdd.width()/2-0):(e.addIsBeforeAnchor=!1,r=t.left+t.width-e.$menuAdd.width()/2+0)):(r=t.left+t.width/2-e.$menuAdd.width()/2,STAGE.mouseY<t.top+t.height/2?(e.addIsBeforeAnchor=!0,s=t.top-e.$menuAdd.height()/2-0):(e.addIsBeforeAnchor=!1,s=t.top+t.height-e.$menuAdd.height()/2+0)));var a=t.left+t.width/2-e.menuAdd.width()/2;switch(e.contextMenuPosition){case"t":case"b":case"c":i=t.left+t.width/2-e.$menu.width()/2;break;case"l":case"tl":case"bl":i=t.left,e.isInList&&(e.horizontal||Math.max(a,r=i+e.$menu.width()+10));break;case"r":case"tr":case"br":default:i=t.left+t.width-e.$menu.width(),e.isInList&&(e.horizontal||(r=Math.min(a,i-e.$menuAdd.width()-10))),i=Math.min(i,STAGE.width-e.$menu.width()-4)}switch(e.contextMenuPosition){case"c":case"l":case"r":o=t.top+t.height/2-e.$menu.height()/2;break;case"b":case"bl":case"br":o=t.top+t.height+0;break;case"t":case"tr":case"tl":default:o=t.top-e.$menu.height()/2-0,o=Math.max(4,o)}if(!e.isInList){switch(e.contextMenuPosition){case"t":case"c":case"b":i+=e.$menu.width()/2+5}r=i-e.$menuAdd.width()-10,s=o}TweenMax.to(e.$menu,0,{x:i,y:o,roundProps:"x,y"}),TweenMax.to(e.$menuAdd,0,{x:r,y:s,roundProps:"x,y"})}}},{key:"show",value:function(){return this.visible=!0,this.$main.css("display","block"),this}},{key:"hide",value:function(){return this.visible=!1,this.$main.css("display","none"),this}},{key:"setAnchor",value:function(e){var t=this;if(t.$anchor=e,t.$anchor){var n=t.$anchor.closest("[context-menu-position]").attr("context-menu-position");n||(n="tr"),t.contextMenuPosition=n;var i=t.$anchor.closest("[context-menu-size]").attr("context-menu-size");t.btns._setSize(i),t.hideAnchor(!1);var o=t.$anchor.closest("[list-horizontal]").attr("list-horizontal");t.horizontal="true"===o;var r=t.$anchor.closest("[context-menu-is-list]").attr("context-menu-is-list");t.isInList="true"===r,t.$anchor.is("#the-cq-layer *")?(t.$main.addClass("is-over"),t.$main.addClass("anchor-is-over"),t.$anchorBox=t.$anchor.closest("[cq-popin-box] main, .wysiwyg-big-menu main")):(t.$main.removeClass("is-over"),t.$main.removeClass("anchor-is-over"),t.$anchorBox=null)}else t.hideAnchor(),t.$anchorBox=null;return this}},{key:"hideAnchor",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.$menuAndSelection.css("display","none"):this.$menuAndSelection.css("display","")}},{key:"isHover",value:function(){return this.$main.is(":hover")}},{key:"somethingIsOpen",value:function(){return this.$popinBoxes.filter(".open").length>0}},{key:"showConfig",value:function(e,t){if(this.setAnchor(null),this.configBox.open(),this.$disabler.css("display",""),this.configBox.$content.empty(),t&&e){var n=$("<div></div>");n.attr("data-pov-v-path",e),n.attr("data-pov-vv-uid",t),n.attr("data-pov-refresh-method","html"),n.attr("id","config-loader"),this.configBox.$content.append(n),n.povRefresh()}else console.error("pas d'uid ou configPath pour charger la config")}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(0),r=(i=o)&&i.__esModule?i:{default:i};n(49);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e||(e=$("<div cq-btn-group size='normal'></div>"));var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n,o=!1;return new MutationObserver(function(t){o||(o=!0,e.removeClass("empty"),0===i.$main.find(">*:visible").length&&e.addClass("empty"),setTimeout(function(){var e;o=!1,(e=i.$main.find(">*:visible")).removeClass("first"),e.removeClass("last"),e.filter(":first").addClass("first"),e.filter(":last").addClass("last")},1))}).observe(e[0],{attributes:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}();t.default=s,$.fn.CqBtnGroup=function(){return $(this).is("[cq-btn-group='init']")?$(this).data("CqBtnGroup"):new s($(this))}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=u(n(3)),r=u(n(8)),s=u(n(6)),a=u(n(52)),l=u(n(17)),c=u(n(57));function u(e){return e&&e.__esModule?e:{default:e}}var d=n(16);n(58);var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.$main.on(Pov.events.DOM_CHANGE,function(){i._initItems()}),n.options=JSON.parse(e.attr("cq-field-options")),n.preventEmpty=n.options.preventEmpty,n.popinXpos=n.options.popinXpos,n.popinYpos=n.options.popinYpos,n.keyEnterAction=n.options.keyEnterAction,n.blockPickerMessage=n.options.blockPickerMessage,n.blockPickerEmptyMessage=n.options.blockPickerEmptyMessage,n.onlyRecords=n.options.onlyRecords,n.onlyImages=n.options.onlyImages,n.onlyRecordsTypes=n.options.onlyRecordsTypes,n.templates=e.attr("wysiwyg-item-templates").split(","),i.templatesLoaded=!1,i.$main.css("opacity",.2),n.blockPicker=new a.default(null,n.blockPickerMessage,n.templates),n.blockPicker.loadTemplates(n.templates,function(){i.templatesLoaded=!0,i.$main.css("opacity","")}),n.$main.on("click",">[cq-block-picker] [path]",function(e){var t=$(this),n=t.attr("path");if(t.find("input[type='file']").length);else if(e.preventDefault(),i.onlyRecords)i.addRecordsItems(null,!1);else{var o=i._$getNewItem(n);i.blockPicker.$main.replaceWith(o),i.field.doSave(!0,function(){o.povRefresh(function(e){i._initItem(e,!0)})}),i.checkIfEmpty()}}),n.$main.on("change",">[cq-block-picker] [path] input[type='file']",function(e){var t=$(this),n=t.closest("[path]").attr("path"),o=e.target.files;if(t.attr("inject-files-in-block")){console.log("créer le block "+n+"et ensuite lui transmetre les fichiers");var r=i._$getNewItem(n);i.blockPicker.$main.replaceWith(r),i.field.doSave(!0,function(){r.povRefresh(function(e){i._initItem(e,!0,o)})}),i.checkIfEmpty()}else console.log("créer un block "+n+" pour chaque fichier"),console.log("addBlocksFiles 2"),i.addBlocksFiles(null,!1,o,n),i.blockPicker.remove()}),n.keyEnterAction&&e.on("keypress","*:focus",function(e){if(13===e.which&&!e.shiftKey)switch(console.log("You pressed enter!",e),e.preventDefault(),e.stopPropagation(),i.keyEnterAction){case"addItem":return void i.addItem(i.templates[0],$(this).closest("[list-item-path]"),!1);default:console.error("keyEnterAction non gérée",i.keyEnterAction)}}),n.field=new o.default(e),d.utils.on(e[0],"update",function(e){i.dispatchChange()}),n._initItems(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"_$getNewItem",value:function(e){return new l.default(e,this).$main}},{key:"addItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this,o=i._$getNewItem(e);t&&t.length?n?o.insertBefore(t):o.insertAfter(t):i.$main.append(o),i.field.doSave(!0,function(){o.povRefresh(function(e){i._initItem(e,!0)})}),i.checkIfEmpty()}},{key:"$itemByKey",value:function(e){return this.$items().filter("[list-item-key='"+e+"']")}},{key:"_startAddingItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;n.onlyRecords?n.addRecordsItems(e,t):this.templates.length>1?(t?n.blockPicker.$main.insertBefore(e):n.blockPicker.$main.insertAfter(e),n.blockPicker.initListeners()):this.addItem(this.templates[0],e,t)}},{key:"addBlocksFiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=[];i=i||this.templates[0];var s=!0,a=!1,l=void 0;try{for(var u,d=n[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value,f=new c.default(i,this,h);r.push(f),e&&e.length?t?f.$main.insertBefore(e):f.$main.insertAfter(e):this.$main.append(f.$main)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}this.field.doSave(!0,function(){var e;(e=r,e.reduce(function(e,t){return e.then(function(){return t.refresh().then(function(){return console.log("2/ le block a été rafraichit...on va uploader"),t.upload()}).then(function(){return console.log("3/ upload ok"),t.refresh()}).then(function(){console.log("4/ refresh après upload ok")})})},Promise.resolve())).then(function(){o&&o()})})}},{key:"addRecordsItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;wysiwyg.recordSelector.open(n.popinXpos,n.popinYpos),wysiwyg.recordSelector.getUids(!0,n.onlyRecordsTypes).then(function(i){var o=[];$.each(i,function(i,r){var s=n._$getNewItem(n.templates[0]);o.push(s),s.setMoreVars("targetUid",r),e&&e.length?t?s.insertBefore(e):s.insertAfter(e):n.$main.append(s)}),n.blockPicker.$main.remove(),n.field.doSave(!0,function(){$.each(o,function(e,t){t.povRefresh(function(e){n._initItem(e,!0)})})}),n.checkIfEmpty()})}},{key:"dispatchChange",value:function(){Pov.events.dispatchDom(this.$main,r.default.events.CHANGED),this.checkIfEmpty()}},{key:"_initItems",value:function(){var e=this;this.templatesLoaded?(this.$items().each(function(){e._initItem($(this))}),e.checkIfEmpty()):setTimeout(function(){e._initItems()},200)}},{key:"checkIfEmpty",value:function(){var e=this;0===this.$items().length?e.templates.length>0?e.preventEmpty?e._startAddingItem(null,!1):(e.$main.append(e.blockPicker.$main),e.blockPicker.setMessage(e.blockPickerEmptyMessage),e.blockPicker.initListeners()):e.$main.on("mouseenter",function(){wysiwyg.contextMenu.show().setAnchor(e.$main).btns.reset(),e.onlyImages?wysiwyg.contextMenu.btns.plusUploadImages(function(t,n){console.log("addBlocksFiles 1"),e.addBlocksFiles(null,t,n,e.templates[0],function(){e.$main.povRefresh()})}):wysiwyg.contextMenu.btns.plus(function(t){e._startAddingItem(null,!1)})}):e.$main.off("mouseenter")}},{key:"_initItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this;i.templatesLoaded||console.error("Les templates ne sont pas encore chargés");var o=e.attr("data-pov-vv-uid");o||console.error("oups pas d'itemUid",e);var r=i.blockPicker.templateItemByPath(e.attr("list-item-path"));function s(){wysiwyg.contextMenu.showConfig(r.config(),o),wysiwyg.contextMenu.configBox.open(i.popinXpos,i.popinYpos)}if(r||console.error("oups pas de template"),!0===t&&e.is("[wysiwyg-open-config='true']")&&r.config()&&s(),n){var a=e.find("[cq-blocks]");if(1!==a.length)return void console.error("êtes vous certain que ce block soit lui-même une liste de blocks?",e);var l=a.CqBlocks();console.log("addBlocksFiles 4"),l.addBlocksFiles(null,!0,n,null,function(){e.povRefresh()}),l.blockPicker.$main.remove()}e.data("itemInit")||(e.data("itemInit",!0),e.on("mouseenter",function(e){e.stopPropagation();var t=$(this);wysiwyg.contextMenu.show().setAnchor(t).btns.reset(),wysiwyg.contextMenu.btns.trash(function(){t.remove(),i.dispatchChange()}),i.onlyImages?wysiwyg.contextMenu.btns.plusUploadImages(function(e,n){console.log("addBlocksFiles 3"),i.addBlocksFiles(t,e,n,i.templates[0])}):wysiwyg.contextMenu.btns.plus(function(e){i._startAddingItem(t,e)}),$(this).is(":first-child")||wysiwyg.contextMenu.btns.before(function(){t.insertBefore(t.prev()),i.dispatchChange()}),$(this).is(":last-child")||wysiwyg.contextMenu.btns.after(function(){t.insertAfter(t.next()),i.dispatchChange()}),r.config()&&wysiwyg.contextMenu.btns.cog(function(){s()})}))}},{key:"destroy",value:function(){(function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}();t.default=h,$.fn.CqBlocks=function(){return $(this).is("[cq-blocks='init']")?$(this).data("CqBlocks"):new h($(this))}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n(53),n(54);var l=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Choisissez",o=arguments[2];if(a(this,t),!e){var r=n(55)({message:window.pov.utils.decodeHtml(i)});e=$(r)}var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),l=s;return s.$buttons=e.find(".buttons-container"),s.$closeBtn=e.find(".close"),s.$message=e.find(".message"),s._templateItemByPath=[],s.loadTemplates(o,function(){var e=!0,n=!1,i=void 0;try{for(var r,s=o[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value,c=t.templatesLoaded[a];l.$buttons.append(c.clone())}}catch(e){n=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(n)throw i}}}),s.initListeners(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"setMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$message.text(e)}},{key:"initListeners",value:function(){var e=this;e.$closeBtn.on("click",function(t){t.preventDefault(),e.remove()})}},{key:"remove",value:function(){this.$main.remove()}},{key:"destroy",value:function(){return!0}},{key:"loadTemplates",value:function(e,n){var i=e.length;function o(){0===i&&n&&n()}for(var r=function(n){var r=e[n],s=$("<div></div>");t.templatesLoaded[r]?i--:window.pov.api.getView("cq-block-picker/block-picker-loader",s,{vv:e[n]},function(e){i--,t.templatesLoaded[r]=e,o()})},s=0;s<e.length;s++)r(s);o()}},{key:"templateItemByPath",value:function(e){return this._templateItemByPath[e]||(this._templateItemByPath[e]=new c(this.$main.find("[path='"+e+"']"))),this._templateItemByPath[e]}}]),t}();t.default=l,l.templatesLoaded={};var c=function(){function e(t){a(this,e),this.$item=t,this.path=t.attr("path")}return o(e,[{key:"config",value:function(){return this.$item.attr("config")}}]),e}()},function(e,t){},function(e,t){},function(e,t,n){var i=n(5);e.exports=function(){var e=new i.Template({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<div id="cq-style" cq-block-picker class="cq-vars-th-black">\r'),i.b("\n"+n),i.b('    <button class="cq-unstyled close">\r'),i.b("\n"+n),i.b('        <svg class="svg wysiwyg-icon">\r'),i.b("\n"+n),i.b('            <use class="svg" xlink:href="#cq-close"></use>\r'),i.b("\n"+n),i.b("        </svg>\r"),i.b("\n"+n),i.b("    </button>\r"),i.b("\n"+n),i.b("\r"),i.b("\n"+n),i.b('    <div class="message">\r'),i.b("\n"+n),i.b("        "),i.b(i.v(i.f("message",e,t,0))),i.b("\r"),i.b("\n"+n),i.b("    </div>\r"),i.b("\n"+n),i.b("\r"),i.b("\n"+n),i.b('    <div class="buttons-container">\r'),i.b("\n"+n),i.b("\r"),i.b("\n"+n),i.b("    </div>\r"),i.b("\n"+n),i.b("</div>"),i.fl()},partials:{},subs:{}},'<div id="cq-style" cq-block-picker class="cq-vars-th-black">\r\n    <button class="cq-unstyled close">\r\n        <svg class="svg wysiwyg-icon">\r\n            <use class="svg" xlink:href="#cq-close"></use>\r\n        </svg>\r\n    </button>\r\n\r\n    <div class="message">\r\n        {{message}}\r\n    </div>\r\n\r\n    <div class="buttons-container">\r\n\r\n    </div>\r\n</div>',i);return e.render.apply(e,arguments)}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(17)),r=s(n(18));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(e,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.file=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"upload",value:function(){var e=this,t=new r.default(this.$main);return new Promise(function(n,i){window.pov.api.upload(e.file,function(e){t.setPercent(e)}).then(function(t){t.json.record?e.setTargetUid(t.json.record.uid).then(function(){n()}):(console.error("oups sur l'upload d'image",t),i())})})}}]),t}();t.default=a},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(18)),s=a(n(3));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return n.$main=e,n.field=new s.default(e),n.src=e.attr("src"),n.imageFormat=n.$main.attr("wysiwyg-image-format"),n.preserveGif="true"===n.$main.attr("wysiwyg-image-preserve-gif"),n.loading=null,e.on("mouseenter",function(){wysiwyg.contextMenu.show().setAnchor(e).btns.reset(),wysiwyg.contextMenu.btns.trash(function(){i.field.$field.attr("wysiwyg-value",""),i.loading=new r.default(i.$main),i.field.doSave(!0,function(){window.pov.api.imageFormat("",i.imageFormat,i.preserveGif).then(function(e){i.setSrc(e),i.loading.destroy()},function(e){console.error(e)})}),i.dispatchChange()}),wysiwyg.contextMenu.btns.plusUploadImages(function(e,t){var n=t[0];n&&(i.loading=new r.default(i.$main),window.pov.api.upload(n,function(e){console.log("zzz upload file "+e),i.loading.setPercent(e)}).then(function(e){console.log("upload ok json",e),i.field.$field.attr("wysiwyg-value",e.json.record.uid),i.field.doSave(!0,function(){window.pov.api.imageFormat(e.json.record.localPath,i.imageFormat,i.preserveGif).then(function(e){i.setSrc(e),i.loading.destroy()},function(e){console.error(e)})})},function(){console.log("erreur upload")}))})}),e.on("mouseleave",function(){wysiwyg.contextMenu.somethingIsOpen()||wysiwyg.contextMenu.isHover()||wysiwyg.contextMenu.hide().setAnchor(null)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"setSrc",value:function(e){this.$main.attr("src",e)}},{key:"dispatchChange",value:function(){Pov.events.dispatchDom(this.$main,Wysiwyg.events.CHANGED)}},{key:"destroy",value:function(){}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(61)),s=a(n(63));function a(e){return e&&e.__esModule?e:{default:e}}n(64),n(65);var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=e.attr("placeholder"),o=n,a={toolbar:{buttons:["bold","italic","anchor","select-record","removeFormat"]},placeholder:{text:i||"Texte ici...",hideOnClick:!1},extensions:{"select-record":new s.default({label:"#page",action:function(e,t,n){function i(){return $("#tmp-tag-medium")}return wysiwyg.recordSelector.getUids(!1,"page,pagefilm,pageauteur,pagevideo").then(function(t){for(var n=i();n.is("a #tmp-tag-medium");)n=n.closest("a");var r=wysiwyg.recordSelector.getRecordUrl(t[0]);n.replaceWith($("<a href='"+r+"'>"+$("<span>"+e+"</span>").text()+"</a>")),o.$main.trigger("input")},function(){i().replaceWith($("<span>"+e+"</span>").text())}),'<span id="tmp-tag-medium" style="background-color: yellow">'+$("<span>"+e+"</span>").text()+"<span>"}})}};return n.mediumEditor=new r.default(e[0],a),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"destroy",value:function(){this.mediumEditor.destroy()}}]),t}();t.default=l},function(e,t,n){(function(i){var o;"classList"in document.createElement("_")||function(e){"use strict";if("Element"in e){var t=e.Element.prototype,n=Object,i=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},r=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},s=function(e,t){if(""===t)throw new r("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new r("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},a=function(e){for(var t=i.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,r=n.length;o<r;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=a.prototype=[],c=function(){return new a(this)};if(r.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return-1!==s(this,e+="")},l.add=function(){var e,t=arguments,n=0,i=t.length,o=!1;do{e=t[n]+"",-1===s(this,e)&&(this.push(e),o=!0)}while(++n<i);o&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,i=0,o=n.length,r=!1;do{for(e=n[i]+"",t=s(this,e);-1!==t;)this.splice(t,1),r=!0,t=s(this,e)}while(++i<o);r&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),i=n?!0!==t&&"remove":!1!==t&&"add";return i&&this[i](e),!0===t||!1===t?t:!n},l.toString=function(){return this.join(" ")},n.defineProperty){var u={get:c,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",u)}catch(e){-2146823252===e.number&&(u.enumerable=!1,n.defineProperty(t,"classList",u))}}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",c)}}(self),function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(e){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,r=i.prototype,s=e.FileReaderSync,a=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,u=e.URL||e.webkitURL||e,d=u.createObjectURL,h=u.revokeObjectURL,f=u,p=e.btoa,m=e.atob,v=e.ArrayBuffer,g=e.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=r.fake=!0;c--;)a.prototype[l[c]]=c+1;return u.createObjectURL||(f=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(b),n.origin=t&&t[1])),n}),f.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):p?t+";base64,"+p(e.data):t+","+encodeURIComponent(e.data)):d?d.call(u,e):void 0},f.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&h&&h.call(u,e)},o.append=function(e){var n=this.data;if(g&&(e instanceof v||e instanceof g)){for(var o="",r=new g(e),l=0,c=r.length;l<c;l++)o+=String.fromCharCode(r[l]);n.push(o)}else if("Blob"===t(e)||"File"===t(e)){if(!s)throw new a("NOT_READABLE_ERR");var u=new s;n.push(u.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&m?n.push(m(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},r.slice=function(e,t,n){var o=arguments.length;return o<3&&(n=null),new i(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},r.toString=function(){return"[object Blob]"},r.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,n){var i=n&&n.type||"",o=new t;if(e)for(var r=0,s=e.length;r<s;r++)Uint8Array&&e[r]instanceof Uint8Array?o.append(e[r].buffer):o.append(e[r]);var a=o.getBlob(i);return!a.slice&&a.webkitSlice&&(a.slice=a.webkitSlice),a};var n=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=n(new e.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),function(r,s){"use strict";"object"==typeof e&&void 0!==i&&i&&i.versions&&i.versions.electron||"object"!=typeof e?void 0===(o=function(){return s}.call(t,n,t,e))||(e.exports=o):e.exports=s}(0,function(){"use strict";function e(e,t){return this.init(e,t)}var t,n,i,o,r,s,a,l,c,u,d;return e.extensions={},function(t){function n(e,t){var n,i=Array.prototype.slice.call(arguments,2);t=t||{};for(var o=0;o<i.length;o++){var r=i[o];if(r)for(n in r)r.hasOwnProperty(n)&&void 0!==r[n]&&(e||!1===t.hasOwnProperty(n))&&(t[n]=r[n])}return t}var i=!1;try{var o=document.createElement("div"),r=document.createTextNode(" ");o.appendChild(r),i=o.contains(r)}catch(e){}var s={isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),isEdge:null!==/Edge\/\d+/.exec(navigator.userAgent),isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(e){return!!(s.isMac&&e.metaKey||!s.isMac&&e.ctrlKey)},isKey:function(e,t){var n=s.getKeyCode(e);return!1===Array.isArray(t)?n===t:-1!==t.indexOf(n)},getKeyCode:function(e){var t=e.which;return null===t&&(t=null!==e.charCode?e.charCode:e.keyCode),t},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var e=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},defaults:function(){var e=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,e)},createLink:function(e,t,n,i){var o=e.createElement("a");return s.moveTextRangeIntoElement(t[0],t[t.length-1],o),o.setAttribute("href",n),i&&("_blank"===i&&o.setAttribute("rel","noopener noreferrer"),o.setAttribute("target",i)),o},findOrCreateMatchingTextNodes:function(e,t,n){for(var i=e.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1),o=[],r=0,a=!1,l=null,c=null;null!==(l=i.nextNode());)if(!(l.nodeType>3))if(3===l.nodeType){if(!a&&n.start<r+l.nodeValue.length&&(a=!0,c=s.splitStartNodeIfNeeded(l,n.start,r)),a&&s.splitEndNodeIfNeeded(l,c,n.end,r),a&&r===n.end)break;if(a&&r>n.end+1)throw new Error("PerformLinking overshot the target!");a&&o.push(c||l),r+=l.nodeValue.length,null!==c&&(r+=c.nodeValue.length,i.nextNode()),c=null}else"img"===l.tagName.toLowerCase()&&(!a&&n.start<=r&&(a=!0),a&&o.push(l));return o},splitStartNodeIfNeeded:function(e,t,n){return t!==n?e.splitText(t-n):null},splitEndNodeIfNeeded:function(e,t,n,i){var o,r;o=i+e.nodeValue.length+(t?t.nodeValue.length:0)-1,r=n-i-(t?e.nodeValue.length:0),o>=n&&i!==o&&0!==r&&(t||e).splitText(r)},splitByBlockElements:function(t){if(3!==t.nodeType&&1!==t.nodeType)return[];var n=[],i=e.util.blockContainerElementNames.join(",");if(3===t.nodeType||0===t.querySelectorAll(i).length)return[t];for(var o=0;o<t.childNodes.length;o++){var r=t.childNodes[o];if(3===r.nodeType)n.push(r);else if(1===r.nodeType){0===r.querySelectorAll(i).length?n.push(r):n=n.concat(e.util.splitByBlockElements(r))}}return n},findAdjacentTextNodeWithContent:function(e,t,n){var i,o=!1,r=n.createNodeIterator(e,NodeFilter.SHOW_TEXT,null,!1);for(i=r.nextNode();i;){if(i===t)o=!0;else if(o&&3===i.nodeType&&i.nodeValue&&i.nodeValue.trim().length>0)break;i=r.nextNode()}return i},findPreviousSibling:function(e){if(!e||s.isMediumEditorElement(e))return!1;for(var t=e.previousSibling;!t&&!s.isMediumEditorElement(e.parentNode);)t=(e=e.parentNode).previousSibling;return t},isDescendant:function(e,t,n){if(!e||!t)return!1;if(e===t)return!!n;if(1!==e.nodeType)return!1;if(i||3!==t.nodeType)return e.contains(t);for(var o=t.parentNode;null!==o;){if(o===e)return!0;o=o.parentNode}return!1},isElement:function(e){return!(!e||1!==e.nodeType)},throttle:function(e,t){var n,i,o,r=null,s=0,a=function(){s=Date.now(),r=null,o=e.apply(n,i),r||(n=i=null)};return t||0===t||(t=50),function(){var l=Date.now(),c=t-(l-s);return n=this,i=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=l,o=e.apply(n,i),r||(n=i=null)):r||(r=setTimeout(a,c)),o}},traverseUp:function(e,t){if(!e)return!1;do{if(1===e.nodeType){if(t(e))return e;if(s.isMediumEditorElement(e))return!1}e=e.parentNode}while(e);return!1},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(t,n){var i,o,r,a,l,c,u,d=!1,h=["insertHTML",!1,n];if(!e.util.isEdge&&t.queryCommandSupported("insertHTML"))try{return t.execCommand.apply(t,h)}catch(e){}if((i=t.getSelection()).rangeCount){if(u=(o=i.getRangeAt(0)).commonAncestorContainer,s.isMediumEditorElement(u)&&!u.firstChild)o.selectNode(u.appendChild(t.createTextNode("")));else if(3===u.nodeType&&0===o.startOffset&&o.endOffset===u.nodeValue.length||3!==u.nodeType&&u.innerHTML===o.toString()){for(;!s.isMediumEditorElement(u)&&u.parentNode&&1===u.parentNode.childNodes.length&&!s.isMediumEditorElement(u.parentNode);)u=u.parentNode;o.selectNode(u)}for(o.deleteContents(),(r=t.createElement("div")).innerHTML=n,a=t.createDocumentFragment();r.firstChild;)l=r.firstChild,c=a.appendChild(l);o.insertNode(a),c&&((o=o.cloneRange()).setStartAfter(c),o.collapse(!0),e.selection.selectRange(t,o)),d=!0}return t.execCommand.callListeners&&t.execCommand.callListeners(h,d),d},execFormatBlock:function(t,n){var i=s.getTopBlockContainer(e.selection.getSelectionStart(t));if("blockquote"===n){if(i&&Array.prototype.slice.call(i.childNodes).some(function(e){return s.isBlockContainer(e)}))return t.execCommand("outdent",!1,null);if(s.isIE)return t.execCommand("indent",!1,n)}if(i&&n===i.nodeName.toLowerCase()&&(n="p"),s.isIE&&(n="<"+n+">"),i&&"blockquote"===i.nodeName.toLowerCase()){if(s.isIE&&"<p>"===n)return t.execCommand("outdent",!1,n);if((s.isFF||s.isEdge)&&"p"===n)return Array.prototype.slice.call(i.childNodes).some(function(e){return!s.isBlockContainer(e)})&&t.execCommand("formatBlock",!1,n),t.execCommand("outdent",!1,n)}return t.execCommand("formatBlock",!1,n)},setTargetBlank:function(e,t){var n,i=t||!1;if("a"===e.nodeName.toLowerCase())e.target="_blank",e.rel="noopener noreferrer";else for(e=e.getElementsByTagName("a"),n=0;n<e.length;n+=1)!1!==i&&i!==e[n].attributes.href.value||(e[n].target="_blank",e[n].rel="noopener noreferrer")},removeTargetBlank:function(e,t){var n;if("a"===e.nodeName.toLowerCase())e.removeAttribute("target"),e.removeAttribute("rel");else for(e=e.getElementsByTagName("a"),n=0;n<e.length;n+=1)t===e[n].attributes.href.value&&(e[n].removeAttribute("target"),e[n].removeAttribute("rel"))},addClassToAnchors:function(e,t){var n,i,o=t.split(" ");if("a"===e.nodeName.toLowerCase())for(i=0;i<o.length;i+=1)e.classList.add(o[i]);else{var r=e.getElementsByTagName("a");if(0===r.length){var a=s.getClosestTag(e,"a");e=a?[a]:[]}else e=r;for(n=0;n<e.length;n+=1)for(i=0;i<o.length;i+=1)e[n].classList.add(o[i])}},isListItem:function(e){if(!e)return!1;if("li"===e.nodeName.toLowerCase())return!0;for(var t=e.parentNode,n=t.nodeName.toLowerCase();"li"===n||!s.isBlockContainer(t)&&"div"!==n;){if("li"===n)return!0;if(!(t=t.parentNode))return!1;n=t.nodeName.toLowerCase()}return!1},cleanListDOM:function(t,n){if("li"===n.nodeName.toLowerCase()){var i=n.parentElement;"p"===i.parentElement.nodeName.toLowerCase()&&(s.unwrap(i.parentElement,t),e.selection.moveCursor(t,n.firstChild,n.firstChild.textContent.length))}},splitOffDOMTree:function(e,t,n){for(var i=t,o=null,r=!n;i!==e;){var s,a=i.parentNode,l=a.cloneNode(!1),c=r?i:a.firstChild;for(o&&(r?l.appendChild(o):s=o),o=l;c;){var u=c.nextSibling;c===i?(c.hasChildNodes()?c=c.cloneNode(!1):c.parentNode.removeChild(c),c.textContent&&o.appendChild(c),c=r?u:null):(c.parentNode.removeChild(c),(c.hasChildNodes()||c.textContent)&&o.appendChild(c),c=u)}s&&o.appendChild(s),i=a}return o},moveTextRangeIntoElement:function(e,t,n){if(!e||!t)return!1;var i=s.findCommonRoot(e,t);if(!i)return!1;if(t===e){var o=e.parentNode,r=e.nextSibling;return o.removeChild(e),n.appendChild(e),r?o.insertBefore(n,r):o.appendChild(n),n.hasChildNodes()}for(var a,l,c,u=[],d=0;d<i.childNodes.length;d++)if(c=i.childNodes[d],a){if(s.isDescendant(c,t,!0)){l=c;break}u.push(c)}else s.isDescendant(c,e,!0)&&(a=c);var h=l.nextSibling,f=i.ownerDocument.createDocumentFragment();return a===e?(a.parentNode.removeChild(a),f.appendChild(a)):f.appendChild(s.splitOffDOMTree(a,e)),u.forEach(function(e){e.parentNode.removeChild(e),f.appendChild(e)}),l===t?(l.parentNode.removeChild(l),f.appendChild(l)):f.appendChild(s.splitOffDOMTree(l,t,!0)),n.appendChild(f),l.parentNode===i?i.insertBefore(n,l):h?i.insertBefore(n,h):i.appendChild(n),n.hasChildNodes()},depthOfNode:function(e){for(var t=0,n=e;null!==n.parentNode;)n=n.parentNode,t++;return t},findCommonRoot:function(e,t){for(var n=s.depthOfNode(e),i=s.depthOfNode(t),o=e,r=t;n!==i;)n>i?(o=o.parentNode,n-=1):(r=r.parentNode,i-=1);for(;o!==r;)o=o.parentNode,r=r.parentNode;return o},isElementAtBeginningOfBlock:function(e){for(var t;!s.isBlockContainer(e)&&!s.isMediumEditorElement(e);){for(t=e;t=t.previousSibling;)if((3===t.nodeType?t.nodeValue:t.textContent).length>0)return!1;e=e.parentNode}return!0},isMediumEditorElement:function(e){return e&&e.getAttribute&&!!e.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(e){return s.traverseUp(e,function(e){return s.isMediumEditorElement(e)})},isBlockContainer:function(e){return e&&3!==e.nodeType&&-1!==s.blockContainerElementNames.indexOf(e.nodeName.toLowerCase())},getClosestBlockContainer:function(e){return s.traverseUp(e,function(e){return s.isBlockContainer(e)||s.isMediumEditorElement(e)})},getTopBlockContainer:function(e){var t=!!s.isBlockContainer(e)&&e;return s.traverseUp(e,function(e){return s.isBlockContainer(e)&&(t=e),!(t||!s.isMediumEditorElement(e))&&(t=e,!0)}),t},getFirstSelectableLeafNode:function(e){for(;e&&e.firstChild;)e=e.firstChild;if("table"===(e=s.traverseUp(e,function(e){return-1===s.emptyElementNames.indexOf(e.nodeName.toLowerCase())})).nodeName.toLowerCase()){var t=e.querySelector("th, td");t&&(e=t)}return e},getFirstTextNode:function(e){return s.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),s._getFirstTextNode(e)},_getFirstTextNode:function(e){if(3===e.nodeType)return e;for(var t=0;t<e.childNodes.length;t++){var n=s._getFirstTextNode(e.childNodes[t]);if(null!==n)return n}return null},ensureUrlHasProtocol:function(e){return-1===e.indexOf("://")?"http://"+e:e},warn:function(){void 0!==t.console&&"function"==typeof t.console.warn&&t.console.warn.apply(t.console,arguments)},deprecated:function(e,t,n){var i=e+" is deprecated, please use "+t+" instead.";n&&(i+=" Will be removed in "+n),s.warn(i)},deprecatedMethod:function(e,t,n,i){s.deprecated(e,t,i),"function"==typeof this[t]&&this[t].apply(this,n)},cleanupAttrs:function(e,t){t.forEach(function(t){e.removeAttribute(t)})},cleanupTags:function(e,t){-1!==t.indexOf(e.nodeName.toLowerCase())&&e.parentNode.removeChild(e)},unwrapTags:function(t,n){-1!==n.indexOf(t.nodeName.toLowerCase())&&e.util.unwrap(t,document)},getClosestTag:function(e,t){return s.traverseUp(e,function(e){return e.nodeName.toLowerCase()===t.toLowerCase()})},unwrap:function(e,t){for(var n=t.createDocumentFragment(),i=Array.prototype.slice.call(e.childNodes),o=0;o<i.length;o++)n.appendChild(i[o]);n.childNodes.length?e.parentNode.replaceChild(n,e):e.parentNode.removeChild(e)},guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};e.util=s}(window),(t=function(t){e.util.extend(this,t)}).extend=function(t){var n,i=this;n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return i.apply(this,arguments)},e.util.extend(n,i);var o=function(){this.constructor=n};return o.prototype=i.prototype,n.prototype=new o,t&&e.util.extend(n.prototype,t),n},t.prototype={init:function(){},base:void 0,name:void 0,checkState:void 0,destroy:void 0,queryCommandState:void 0,isActive:void 0,isAlreadyApplied:void 0,setActive:void 0,setInactive:void 0,getInteractionElements:void 0,window:void 0,document:void 0,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(e){return this.base.options[e]}},["execAction","on","off","subscribe","trigger"].forEach(function(e){t.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}}),e.Extension=t,function(){function t(t){return e.util.isBlockContainer(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(t,n){var i,o=n.getSelection();return 0!==o.rangeCount&&(i=o.getRangeAt(0).commonAncestorContainer,e.util.traverseUp(i,t))},getSelectionElement:function(t){return this.findMatchingSelectionParent(function(t){return e.util.isMediumEditorElement(t)},t)},exportSelection:function(e,t){if(!e)return null;var n=null,i=t.getSelection();if(i.rangeCount>0){var o,r=i.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(e),s.setEnd(r.startContainer,r.startOffset),n={start:o=s.toString().length,end:o+r.toString().length},this.doesRangeStartWithImages(r,t)&&(n.startsWithImage=!0);var a=this.getTrailingImageCount(e,n,r.endContainer,r.endOffset);if(a&&(n.trailingImageCount=a),0!==o){var l=this.getIndexRelativeToAdjacentEmptyBlocks(t,e,r.startContainer,r.startOffset);-1!==l&&(n.emptyBlocksIndex=l)}}return n},importSelection:function(e,t,n,i){if(e&&t){var o=n.createRange();o.setStart(t,0),o.collapse(!0);var r,s=t,a=[],l=0,c=!1,u=!1,d=0,h=!1,f=!1,p=null;for((i||e.startsWithImage||void 0!==e.emptyBlocksIndex)&&(f=!0);!h&&s;)if(s.nodeType>3)s=a.pop();else{if(3!==s.nodeType||u){if(e.trailingImageCount&&u&&("img"===s.nodeName.toLowerCase()&&d++,d===e.trailingImageCount)){for(var m=0;s.parentNode.childNodes[m]!==s;)m++;o.setEnd(s.parentNode,m+1),h=!0}if(!h&&1===s.nodeType)for(var v=s.childNodes.length-1;v>=0;)a.push(s.childNodes[v]),v-=1}else r=l+s.length,!c&&e.start>=l&&e.start<=r&&(f||e.start<r?(o.setStart(s,e.start-l),c=!0):p=s),c&&e.end>=l&&e.end<=r&&(e.trailingImageCount?u=!0:(o.setEnd(s,e.end-l),h=!0)),l=r;h||(s=a.pop())}!c&&p&&(o.setStart(p,p.length),o.setEnd(p,p.length)),void 0!==e.emptyBlocksIndex&&(o=this.importSelectionMoveCursorPastBlocks(n,t,e.emptyBlocksIndex,o)),i&&(o=this.importSelectionMoveCursorPastAnchor(e,o)),this.selectRange(n,o)}},importSelectionMoveCursorPastAnchor:function(t,n){if(t.start===t.end&&3===n.startContainer.nodeType&&n.startOffset===n.startContainer.nodeValue.length&&e.util.traverseUp(n.startContainer,function(e){return"a"===e.nodeName.toLowerCase()})){for(var i=n.startContainer,o=n.startContainer.parentNode;null!==o&&"a"!==o.nodeName.toLowerCase();)o.childNodes[o.childNodes.length-1]!==i?o=null:(i=o,o=o.parentNode);if(null!==o&&"a"===o.nodeName.toLowerCase()){for(var r=null,s=0;null===r&&s<o.parentNode.childNodes.length;s++)o.parentNode.childNodes[s]===o&&(r=s);n.setStart(o.parentNode,r+1),n.collapse(!0)}}return n},importSelectionMoveCursorPastBlocks:function(n,i,o,r){var s,a,l=n.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,t,!1),c=r.startContainer,u=0;for(o=o||1,s=3===c.nodeType&&e.util.isBlockContainer(c.previousSibling)?c.previousSibling:e.util.getClosestBlockContainer(c);l.nextNode();)if(a){if(a=l.currentNode,++u===o)break;if(a.textContent.length>0)break}else s===l.currentNode&&(a=l.currentNode);return a||(a=s),r.setStart(e.util.getFirstSelectableLeafNode(a),0),r},getIndexRelativeToAdjacentEmptyBlocks:function(n,i,o,r){if(o.textContent.length>0&&r>0)return-1;var s=o;if(3!==s.nodeType&&(s=o.childNodes[r]),s){if(!e.util.isElementAtBeginningOfBlock(s))return-1;var a=e.util.findPreviousSibling(s);if(!a)return-1;if(a.nodeValue)return-1}for(var l=e.util.getClosestBlockContainer(o),c=n.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,t,!1),u=0;c.nextNode();){var d=""===c.currentNode.textContent;if((d||u>0)&&(u+=1),c.currentNode===l)return u;d||(u=0)}return u},doesRangeStartWithImages:function(e,t){if(0!==e.startOffset||1!==e.startContainer.nodeType)return!1;if("img"===e.startContainer.nodeName.toLowerCase())return!0;var n=e.startContainer.querySelector("img");if(!n)return!1;for(var i=t.createTreeWalker(e.startContainer,NodeFilter.SHOW_ALL,null,!1);i.nextNode();){var o=i.currentNode;if(o===n)break;if(o.nodeValue)return!1}return!0},getTrailingImageCount:function(e,t,n,i){if(0===i||1!==n.nodeType)return 0;if("img"!==n.nodeName.toLowerCase()&&!n.querySelector("img"))return 0;for(var o=n.childNodes[i-1];o.hasChildNodes();)o=o.lastChild;for(var r,s=e,a=[],l=0,c=!1,u=!1,d=!1,h=0;!d&&s;)if(s.nodeType>3)s=a.pop();else{if(3!==s.nodeType||u){if("img"===s.nodeName.toLowerCase()&&h++,s===o)d=!0;else if(1===s.nodeType)for(var f=s.childNodes.length-1;f>=0;)a.push(s.childNodes[f]),f-=1}else h=0,r=l+s.length,!c&&t.start>=l&&t.start<=r&&(c=!0),c&&t.end>=l&&t.end<=r&&(u=!0),l=r;d||(s=a.pop())}return h},selectionContainsContent:function(e){var t=e.getSelection();if(!t||t.isCollapsed||!t.rangeCount)return!1;if(""!==t.toString().trim())return!0;var n=this.getSelectedParentElement(t.getRangeAt(0));return!(!n||!("img"===n.nodeName.toLowerCase()||1===n.nodeType&&n.querySelector("img")))},selectionInContentEditableFalse:function(e){var t,n=this.findMatchingSelectionParent(function(e){var n=e&&e.getAttribute("contenteditable");return"true"===n&&(t=!0),"#text"!==e.nodeName&&"false"===n},e);return!t&&n},getSelectionHtml:function(e){var t,n,i,o="",r=e.getSelection();if(r.rangeCount){for(i=e.createElement("div"),t=0,n=r.rangeCount;t<n;t+=1)i.appendChild(r.getRangeAt(t).cloneContents());o=i.innerHTML}return o},getCaretOffsets:function(e,t){var n,i;return t||(t=window.getSelection().getRangeAt(0)),n=t.cloneRange(),i=t.cloneRange(),n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset),i.selectNodeContents(e),i.setStart(t.endContainer,t.endOffset),{left:n.toString().length,right:i.toString().length}},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(e){return e?this.rangeSelectsSingleNode(e)&&3!==e.startContainer.childNodes[e.startOffset].nodeType?e.startContainer.childNodes[e.startOffset]:3===e.startContainer.nodeType?e.startContainer.parentNode:e.startContainer:null},getSelectedElements:function(e){var t,n,i,o=e.getSelection();if(!o.rangeCount||o.isCollapsed||!o.getRangeAt(0).commonAncestorContainer)return[];if(3===(t=o.getRangeAt(0)).commonAncestorContainer.nodeType){for(n=[],i=t.commonAncestorContainer;i.parentNode&&1===i.parentNode.childNodes.length;)n.push(i.parentNode),i=i.parentNode;return n}return[].filter.call(t.commonAncestorContainer.getElementsByTagName("*"),function(e){return"function"!=typeof o.containsNode||o.containsNode(e,!0)})},selectNode:function(e,t){var n=t.createRange();n.selectNodeContents(e),this.selectRange(t,n)},select:function(e,t,n,i,o){var r=e.createRange();return r.setStart(t,n),i?r.setEnd(i,o):r.collapse(!0),this.selectRange(e,r),r},clearSelection:function(e,t){t?e.getSelection().collapseToStart():e.getSelection().collapseToEnd()},moveCursor:function(e,t,n){this.select(e,t,n)},getSelectionRange:function(e){var t=e.getSelection();return 0===t.rangeCount?null:t.getRangeAt(0)},selectRange:function(e,t){var n=e.getSelection();n.removeAllRanges(),n.addRange(t)},getSelectionStart:function(e){var t=e.getSelection().anchorNode;return t&&3===t.nodeType?t.parentNode:t}};e.selection=n}(),function(){function t(t,n){return!!t&&t.some(function(t){if("function"!=typeof t.getInteractionElements)return!1;var i=t.getInteractionElements();return!!i&&(Array.isArray(i)||(i=[i]),i.some(function(t){return e.util.isDescendant(t,n,!0)}))})}var n=function(e){this.base=e,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(t,n,i,o){var r=this.base.options.contentWindow,s=this.base.options.ownerDocument;t=e.util.isElement(t)||[r,s].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){e.addEventListener(n,i,o),this.events.push([e,n,i,o])}.bind(this))},detachDOMEvent:function(t,n,i,o){var r,s,a=this.base.options.contentWindow,l=this.base.options.ownerDocument;t&&(t=e.util.isElement(t)||[a,l].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){-1!==(r=this.indexOfListener(e,n,i,o))&&(s=this.events.splice(r,1)[0])[0].removeEventListener(s[1],s[2],s[3])}.bind(this)))},indexOfListener:function(e,t,n,i){var o,r,s;for(o=0,r=this.events.length;o<r;o+=1)if((s=this.events[o])[0]===e&&s[1]===t&&s[2]===n&&s[3]===i)return o;return-1},detachAllDOMEvents:function(){for(var e=this.events.pop();e;)e[0].removeEventListener(e[1],e[2],e[3]),e=this.events.pop()},detachAllEventsFromElement:function(e){for(var t=this.events.filter(function(t){return t&&t[0].getAttribute&&t[0].getAttribute("medium-editor-index")===e.getAttribute("medium-editor-index")}),n=0,i=t.length;n<i;n++){var o=t[n];this.detachDOMEvent(o[0],o[1],o[2],o[3])}},attachAllEventsToElement:function(e){this.listeners.editableInput&&(this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(t){this.attachDOMEvent(e,t.name,t.handler.bind(this))},this)},enableCustomEvent:function(e){void 0!==this.disabledEvents[e]&&delete this.disabledEvents[e]},disableCustomEvent:function(e){this.disabledEvents[e]=!0},attachCustomEvent:function(e,t){this.setupListener(e),this.customEvents[e]||(this.customEvents[e]=[]),this.customEvents[e].push(t)},detachCustomEvent:function(e,t){var n=this.indexOfCustomListener(e,t);-1!==n&&this.customEvents[e].splice(n,1)},indexOfCustomListener:function(e,t){return this.customEvents[e]&&this.customEvents[e].length?this.customEvents[e].indexOf(t):-1},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(e,t,n){this.customEvents[e]&&!this.disabledEvents[e]&&this.customEvents[e].forEach(function(e){e(t,n)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(e){e.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){this.execCommandListener||(this.execCommandListener=function(e){this.handleDocumentExecCommand(e)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener))},detachExecCommand:function(){var e=this.options.ownerDocument;if(this.execCommandListener&&e.execCommand.listeners){var t=e.execCommand.listeners.indexOf(this.execCommandListener);-1!==t&&e.execCommand.listeners.splice(t,1),e.execCommand.listeners.length||this.unwrapExecCommand()}},wrapExecCommand:function(){var e=this.options.ownerDocument;if(!e.execCommand.listeners){var t=function(t,n){e.execCommand.listeners&&e.execCommand.listeners.forEach(function(e){e({command:t[0],value:t[2],args:t,result:n})})},n=function(){var n=e.execCommand.orig.apply(this,arguments);if(!e.execCommand.listeners)return n;var i=Array.prototype.slice.call(arguments);return t(i,n),n};n.orig=e.execCommand,n.listeners=[],n.callListeners=t,e.execCommand=n}},unwrapExecCommand:function(){var e=this.options.ownerDocument;e.execCommand.orig&&(e.execCommand=e.execCommand.orig)},setupListener:function(e){if(!this.listeners[e]){switch(e){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(e){this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":case"editableKeydownEnter":case"editableKeydownTab":case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[e]=!0}},attachToEachElement:function(e,t){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(n){this.attachDOMEvent(n,e,t.bind(this))},this),this.eventsCache.push({name:e,handler:t})},cleanupElement:function(e){var t=e.getAttribute("medium-editor-index");t&&(this.detachAllEventsFromElement(e),this.contentCache&&delete this.contentCache[t])},focusElement:function(e){e.focus(),this.updateFocus(e,{target:e,type:"focus"})},updateFocus:function(n,i){var o,r=this.base.getFocusedElement();r&&"click"===i.type&&this.lastMousedownTarget&&(e.util.isDescendant(r,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(o=r),o||this.base.elements.some(function(t){return!o&&e.util.isDescendant(t,n,!0)&&(o=t),!!o},this);var s=!e.util.isDescendant(r,n,!0)&&!t(this.base.extensions,n);o!==r&&(r&&s&&(r.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",i,r)),o&&(o.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",i,o))),s&&this.triggerCustomEvent("externalInteraction",i)},updateInput:function(e,t){if(this.contentCache){var n=e.getAttribute("medium-editor-index"),i=e.innerHTML;i!==this.contentCache[n]&&this.triggerCustomEvent("editableInput",t,e),this.contentCache[n]=i}},handleDocumentSelectionChange:function(t){if(t.currentTarget&&t.currentTarget.activeElement){var n,i=t.currentTarget.activeElement;this.base.elements.some(function(t){return!!e.util.isDescendant(t,i,!0)&&(n=t,!0)},this),n&&this.updateInput(n,{target:i,currentTarget:n})}},handleDocumentExecCommand:function(){var e=this.base.getFocusedElement();e&&this.updateInput(e,{target:e,currentTarget:e})},handleBodyClick:function(e){this.updateFocus(e.target,e)},handleBodyFocus:function(e){this.updateFocus(e.target,e)},handleBodyMousedown:function(e){this.lastMousedownTarget=e.target},handleInput:function(e){this.updateInput(e.currentTarget,e)},handleClick:function(e){this.triggerCustomEvent("editableClick",e,e.currentTarget)},handleBlur:function(e){this.triggerCustomEvent("editableBlur",e,e.currentTarget)},handleKeypress:function(e){if(this.triggerCustomEvent("editableKeypress",e,e.currentTarget),this.keypressUpdateInput){var t={target:e.target,currentTarget:e.currentTarget};setTimeout(function(){this.updateInput(t.currentTarget,t)}.bind(this),0)}},handleKeyup:function(e){this.triggerCustomEvent("editableKeyup",e,e.currentTarget)},handleMouseover:function(e){this.triggerCustomEvent("editableMouseover",e,e.currentTarget)},handleDragging:function(e){this.triggerCustomEvent("editableDrag",e,e.currentTarget)},handleDrop:function(e){this.triggerCustomEvent("editableDrop",e,e.currentTarget)},handlePaste:function(e){this.triggerCustomEvent("editablePaste",e,e.currentTarget)},handleKeydown:function(t){return this.triggerCustomEvent("editableKeydown",t,t.currentTarget),e.util.isKey(t,e.util.keyCode.SPACE)?this.triggerCustomEvent("editableKeydownSpace",t,t.currentTarget):e.util.isKey(t,e.util.keyCode.ENTER)||t.ctrlKey&&e.util.isKey(t,e.util.keyCode.M)?this.triggerCustomEvent("editableKeydownEnter",t,t.currentTarget):e.util.isKey(t,e.util.keyCode.TAB)?this.triggerCustomEvent("editableKeydownTab",t,t.currentTarget):e.util.isKey(t,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE])?this.triggerCustomEvent("editableKeydownDelete",t,t.currentTarget):void 0}},e.Events=n}(),(n=e.Extension.extend({action:void 0,aria:void 0,tagNames:void 0,style:void 0,useQueryState:void 0,contentDefault:void 0,contentFA:void 0,classList:void 0,attrs:void 0,constructor:function(t){n.isBuiltInButton(t)?e.Extension.call(this,this.defaults[t]):e.Extension.call(this,t)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return"function"==typeof this.action?this.action(this.base.options):this.action},getAria:function(){return"function"==typeof this.aria?this.aria(this.base.options):this.aria},getTagNames:function(){return"function"==typeof this.tagNames?this.tagNames(this.base.options):this.tagNames},createButton:function(){var e=this.document.createElement("button"),t=this.contentDefault,n=this.getAria(),i=this.getEditorOption("buttonLabels");return e.classList.add("medium-editor-action"),e.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(t){e.classList.add(t)}),e.setAttribute("data-action",this.getAction()),n&&(e.setAttribute("title",n),e.setAttribute("aria-label",n)),this.attrs&&Object.keys(this.attrs).forEach(function(t){e.setAttribute(t,this.attrs[t])},this),"fontawesome"===i&&this.contentFA&&(t=this.contentFA),e.innerHTML=t,e},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.getAction();t&&this.execAction(t)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var e=null;return this.useQueryState&&(e=this.base.queryCommandState(this.getAction())),e},isAlreadyApplied:function(e){var t,n,i=!1,o=this.getTagNames();return!1===this.knownState||!0===this.knownState?this.knownState:(o&&o.length>0&&(i=-1!==o.indexOf(e.nodeName.toLowerCase())),!i&&this.style&&(t=this.style.value.split("|"),n=this.window.getComputedStyle(e,null).getPropertyValue(this.style.prop),t.forEach(function(e){this.knownState||((i=-1!==n.indexOf(e))||"text-decoration"!==this.style.prop)&&(this.knownState=i)},this)),i)}})).isBuiltInButton=function(t){return"string"==typeof t&&e.extensions.button.prototype.defaults.hasOwnProperty(t)},e.extensions.button=n,e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},html:{name:"html",action:"html",aria:"evaluate html",tagNames:["iframe","object"],contentDefault:"<b>html</b>",contentFA:'<i class="fa fa-code"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}},i=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return!!this.hasForm&&this.getForm().classList.contains(this.activeClass)},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.hideToolbarDefaultActions()},setToolbarPosition:function(){var e=this.base.getExtensionByName("toolbar");e&&e.setToolbarPosition()}}),e.extensions.form=i,o=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(t){t.preventDefault(),t.stopPropagation();var n=e.selection.getSelectionRange(this.document);return"a"===n.startContainer.nodeName.toLowerCase()||"a"===n.endContainer.nodeName.toLowerCase()||e.util.getClosestTag(e.selection.getSelectedParentElement(n),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(t){e.util.isKey(t,e.util.keyCode.K)&&e.util.isMetaCtrlKey(t)&&!t.shiftKey&&this.handleClick(t)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var e=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return e.push('<a href="#" class="medium-editor-toolbar-save">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),e.push('<a href="#" class="medium-editor-toolbar-close">',"fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target" id="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">','<label for="medium-editor-toolbar-anchor-target-field-'+this.getEditorId()+'">',this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),e.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(t){var n=this.getInput(),i=this.getAnchorTargetCheckbox(),o=this.getAnchorButtonCheckbox();if("string"==typeof(t=t||{value:""})&&(t={value:t}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),n.value=t.value,n.focus(),i&&(i.checked="_blank"===t.target),o){var r=t.buttonClass?t.buttonClass.split(" "):[];o.checked=-1!==r.indexOf(this.customClassOption)}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var e=this.getAnchorTargetCheckbox(),t=this.getAnchorButtonCheckbox(),n={value:this.getInput().value.trim()};return this.linkValidation&&(n.value=this.checkLinkFormat(n.value)),n.target="_self",e&&e.checked&&(n.target="_blank"),t&&t.checked&&(n.buttonClass=this.customClassOption),n},doFormSave:function(){var e=this.getFormOpts();this.completeFormSave(e)},completeFormSave:function(e){this.base.restoreSelection(),this.execAction(this.action,e),this.base.checkSelection()},ensureEncodedUri:function(e){return e===decodeURI(e)?encodeURI(e):e},ensureEncodedUriComponent:function(e){return e===decodeURIComponent(e)?encodeURIComponent(e):e},ensureEncodedParam:function(e){var t=e.split("="),n=t[0],i=t[1];return n+(void 0===i?"":"="+this.ensureEncodedUriComponent(i))},ensureEncodedQuery:function(e){return e.split("&").map(this.ensureEncodedParam.bind(this)).join("&")},checkLinkFormat:function(e){var t=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i.test(e),n="",i=e.match(/^(.*?)(?:\?(.*?))?(?:#(.*))?$/),o=i[1],r=i[2],s=i[3];if(/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/.test(e))return"tel:"+e;if(!t){var a=o.split("/")[0];(a.match(/.+(\.|:).+/)||"localhost"===a)&&(n="http://")}return n+this.ensureEncodedUri(o)+(void 0===r?"":"?"+this.ensureEncodedQuery(r))+(void 0===s?"":"#"+s)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(e){var t=e.querySelector(".medium-editor-toolbar-close"),n=e.querySelector(".medium-editor-toolbar-save"),i=e.querySelector(".medium-editor-toolbar-input");this.on(e,"click",this.handleFormClick.bind(this)),this.on(i,"keyup",this.handleTextboxKeyup.bind(this)),this.on(t,"click",this.handleCloseClick.bind(this)),this.on(n,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var e=this.document.createElement("div");return e.className="medium-editor-toolbar-form",e.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),e.innerHTML=this.getTemplate(),this.attachFormEvents(e),e},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(t){if(t.keyCode===e.util.keyCode.ENTER)return t.preventDefault(),void this.doFormSave();t.keyCode===e.util.keyCode.ESCAPE&&(t.preventDefault(),this.doFormCancel())},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.anchor=o,r=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var e=this.document.createElement("div");return e.id="medium-editor-anchor-preview-"+this.getEditorId(),e.className="medium-editor-anchor-preview",e.innerHTML=this.getTemplate(),this.on(e,"click",this.handleClick.bind(this)),e},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview&&this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(e){return!(!this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&!e.getAttribute("data-disable-preview"))||(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=e.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=e.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=e,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(e){e=e||this.activeAnchor;var t,n,i,o,r,s=this.window.innerWidth,a=this.anchorPreview.offsetHeight,l=e.getBoundingClientRect(),c=this.diffLeft,u=this.diffTop,d=this.getEditorOption("elementsContainer"),h=["absolute","fixed"].indexOf(window.getComputedStyle(d).getPropertyValue("position"))>-1,f={};t=this.anchorPreview.offsetWidth/2;var p=this.base.getExtensionByName("toolbar");p&&(c=p.diffLeft,u=p.diffTop),n=c-t,h?(o=d.getBoundingClientRect(),["top","left"].forEach(function(e){f[e]=l[e]-o[e]}),f.width=l.width,f.height=l.height,l=f,s=o.width,r=d.scrollTop):r=this.window.pageYOffset,i=l.left+l.width/2,r+=a+l.top+l.height-u-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(r)+"px",this.anchorPreview.style.right="initial",i<t?(this.anchorPreview.style.left=n+t+"px",this.anchorPreview.style.right="initial"):s-i<t?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=n+i+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(e){var t=this.base.getExtensionByName("anchor"),n=this.activeAnchor;t&&n&&(e.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(n){var e={value:n.attributes.href.value,target:n.getAttribute("target"),buttonClass:n.getAttribute("class")};t.showForm(e),n=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(t){var n=e.util.getClosestTag(t.target,"a");if(!1!==n){if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(n.outerHTML)||/href=["']#\S+["']/.test(n.outerHTML)))return!0;var i=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&i&&i.isDisplayed&&i.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==n&&this.detachPreviewHandlers(),this.anchorToPreview=n,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))}},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(this.hovering=!1)},updatePreview:function(){if(this.hovering)return!0;(new Date).getTime()-this.lastOver>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}}),e.extensions.anchorPreview=r,function(){var t,n,i,o,r;t=[" ","\t","\n","\r"," "," "," "," "," ","\u2028","\u2029"],i="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+(n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw")+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’])))|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",o=new RegExp("^("+n+")$","i"),r=new RegExp(i,"gi");var s=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){for(var e=0,t=0;t<this.window._mediumEditors.length;t++){var n=this.window._mediumEditors[t];null!==n&&void 0!==n.getExtensionByName("autoLink")&&e++}return 1===e},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(e,t){this.performLinking(t)},onKeypress:function(t){this.disableEventHandling||e.util.isKey(t,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var e=this.base.exportSelection();this.performLinking(t.target)&&this.base.importSelection(e,!0)}catch(e){window.console&&window.console.error("Failed to perform linking",e),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(t){var n=e.util.splitByBlockElements(t),i=!1;0===n.length&&(n=[t]);for(var o=0;o<n.length;o++)i=this.removeObsoleteAutoLinkSpans(n[o])||i,i=this.performLinkingWithinElement(n[o])||i;return this.base.events.updateInput(t,{target:t,currentTarget:t}),i},removeObsoleteAutoLinkSpans:function(t){if(!t||3===t.nodeType)return!1;for(var n,i=t.querySelectorAll('span[data-auto-link="true"]'),o=!1,r=0;r<i.length;r++){var s=i[r].textContent;if(-1===s.indexOf("://")&&(s=e.util.ensureUrlHasProtocol(s)),i[r].getAttribute("data-href")!==s&&(n=i[r],!e.util.getClosestTag(n,"a"))){o=!0;var a=s.replace(/\s+$/,"");if(i[r].getAttribute("data-href")===a){var l=s.length-a.length,c=e.util.splitOffDOMTree(i[r],this.splitTextBeforeEnd(i[r],l));i[r].parentNode.insertBefore(c,i[r].nextSibling)}else e.util.unwrap(i[r],this.document)}}return o},splitTextBeforeEnd:function(e,t){for(var n,i,o,r=this.document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),s=!0;s;)s=null!==r.lastChild();for(;t>0&&null!==o;)(i=(n=r.currentNode).nodeValue).length>t?(o=n.splitText(i.length-t),t=0):(o=r.previousNode(),t-=i.length);return o},performLinkingWithinElement:function(t){for(var n=this.findLinkableText(t),i=0;i<n.length;i++){var o=e.util.findOrCreateMatchingTextNodes(this.document,t,n[i]);this.shouldNotLink(o)||this.createAutoLink(o,n[i].href)}return!1},shouldNotLink:function(t){for(var n=!1,i=0;i<t.length&&!1===n;i++)n=!!e.util.traverseUp(t[i],function(e){return"a"===e.nodeName.toLowerCase()||e.getAttribute&&"true"===e.getAttribute("data-auto-link")});return n},findLinkableText:function(e){for(var n=e.textContent,i=null,s=[];null!==(i=r.exec(n));){var a=i.index+i[0].length;!(0!==i.index&&-1===t.indexOf(n[i.index-1])||a!==n.length&&-1===t.indexOf(n[a]))&&(-1!==i[0].indexOf("/")||o.test(i[0].split(".").pop().split("?").shift()))&&s.push({href:i[0],start:i.index,end:a})}return s},createAutoLink:function(t,n){n=e.util.ensureUrlHasProtocol(n);var i=e.util.createLink(this.document,t,n,this.getEditorOption("targetBlank")?"_blank":null),o=this.document.createElement("span");for(o.setAttribute("data-auto-link","true"),o.setAttribute("data-href",n),i.insertBefore(o,i.firstChild);i.childNodes.length>1;)o.appendChild(i.childNodes[1])}});e.extensions.autoLink=s}(),function(){var t="medium-editor-dragover";function n(n){var i=e.util.getContainerEditorElement(n);Array.prototype.slice.call(i.parentElement.querySelectorAll("."+t)).forEach(function(e){e.classList.remove(t)})}var i=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy";var i=e.target.classList?e.target:e.target.parentElement;n(i),"dragover"===e.type&&i.classList.add(t)},handleDrop:function(e){e.preventDefault(),e.stopPropagation(),this.base.selectElement(e.target);var t=this.base.exportSelection();t.start=t.end,this.base.importSelection(t),e.dataTransfer.files&&Array.prototype.slice.call(e.dataTransfer.files).forEach(function(e){this.isAllowedFile(e)&&e.type.match("image")&&this.insertImageFile(e)},this),n(e.target)},isAllowedFile:function(e){return this.allowedTypes.some(function(t){return!!e.type.match(t)})},insertImageFile:function(t){if("function"==typeof FileReader){var n=new FileReader;n.readAsDataURL(t),n.addEventListener("load",function(t){var n=this.document.createElement("img");n.src=t.target.result,e.util.insertHTMLCommand(this.document,n.outerHTML)}.bind(this))}}});e.extensions.fileDragging=i}(),s=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(e){var t=e.key.charCodeAt(0);this.keys[t]||(this.keys[t]=[]),this.keys[t].push(e)},this)},handleKeydown:function(t){var n=e.util.getKeyCode(t);if(this.keys[n]){var i=e.util.isMetaCtrlKey(t),o=!!t.shiftKey,r=!!t.altKey;this.keys[n].forEach(function(e){e.meta!==i||e.shift!==o||e.alt!==r&&void 0!==e.alt||(t.preventDefault(),t.stopPropagation(),"function"==typeof e.command?e.command.apply(this):!1!==e.command&&this.execAction(e.command))},this)}}}),e.extensions.keyboardCommands=s,a=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var t=this.document.queryCommandValue("fontName")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(e){var t=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var e,t=this.document,n=t.createElement("div"),i=t.createElement("select"),o=t.createElement("a"),r=t.createElement("a");n.className="medium-editor-toolbar-form",n.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(n,"click",this.handleFormClick.bind(this));for(var s=0;s<this.fonts.length;s++)(e=t.createElement("option")).innerHTML=this.fonts[s],e.value=this.fonts[s],i.appendChild(e);return i.className="medium-editor-toolbar-select",n.appendChild(i),this.on(i,"change",this.handleFontChange.bind(this)),r.setAttribute("href","#"),r.className="medium-editor-toobar-save",r.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",n.appendChild(r),this.on(r,"click",this.handleSaveClick.bind(this),!0),o.setAttribute("href","#"),o.className="medium-editor-toobar-close",o.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",n.appendChild(o),this.on(o,"click",this.handleCloseClick.bind(this)),n},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("face")&&e.removeAttribute("face")})},handleFontChange:function(){var e=this.getSelect().value;""===e?this.clearFontName():this.execAction("fontName",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.fontName=a,l=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.isDisplayed()){var t=this.document.queryCommandValue("fontSize")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return"block"===this.getForm().style.display},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(e){var t=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("input"),i=e.createElement("a"),o=e.createElement("a");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this)),n.setAttribute("type","range"),n.setAttribute("min","1"),n.setAttribute("max","7"),n.className="medium-editor-toolbar-input",t.appendChild(n),this.on(n,"change",this.handleSliderChange.bind(this)),o.setAttribute("href","#"),o.className="medium-editor-toobar-save",o.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(o),this.on(o,"click",this.handleSaveClick.bind(this),!0),i.setAttribute("href","#"),i.className="medium-editor-toobar-close",i.innerHTML="fontawesome"===this.getEditorOption("buttonLabels")?'<i class="fa fa-times"></i>':"&times;",t.appendChild(i),this.on(i,"click",this.handleCloseClick.bind(this)),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(e){"font"===e.nodeName.toLowerCase()&&e.hasAttribute("size")&&e.removeAttribute("size")})},handleSliderChange:function(){var e=this.getInput().value;"4"===e?this.clearFontSize():this.execAction("fontSize",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}}),e.extensions.fontSize=l,function(){var t=null,n=null,i=function(e){e.stopPropagation()};function o(e,t,n){var i=e.clipboardData||t.clipboardData||n.dataTransfer,o={};if(!i)return o;if(i.getData){var r=i.getData("Text");r&&r.length>0&&(o["text/plain"]=r)}if(i.types)for(var s=0;s<i.types.length;s++){var a=i.types[s];o[a]=i.getData(a)}return o}var r=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],unwrapTags:[],init:function(){e.Extension.prototype.init.apply(this,arguments),(this.forcePlainText||this.cleanPastedHTML)&&(this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(e){this.on(e,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this)))},handleAddElement:function(e,t){this.on(t,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(e,t){if(!e.defaultPrevented){var n=o(e,this.window,this.document),i=n["text/html"],r=n["text/plain"];this.window.clipboardData&&void 0===e.clipboardData&&!i&&(i=r),(i||r)&&(e.preventDefault(),this.doPaste(i,r,t))}},doPaste:function(t,n,i){var o,r,s="";if(this.cleanPastedHTML&&t)return this.cleanPaste(t);if(n){if(this.getEditorOption("disableReturn")||i&&i.getAttribute("data-disable-return"))s=e.util.htmlEntities(n);else if((o=n.split(/[\r\n]+/g)).length>1)for(r=0;r<o.length;r+=1)""!==o[r]&&(s+="<p>"+e.util.htmlEntities(o[r])+"</p>");else s=e.util.htmlEntities(o[0]);e.util.insertHTMLCommand(this.document,s)}},handlePasteBinPaste:function(e){if(e.defaultPrevented)this.removePasteBin();else{var t=o(e,this.window,this.document),i=t["text/html"],r=t["text/plain"],s=n;if(!this.cleanPastedHTML||i)return e.preventDefault(),this.removePasteBin(),this.doPaste(i,r,s),void this.trigger("editablePaste",{currentTarget:s,target:s},s);setTimeout(function(){this.cleanPastedHTML&&(i=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(i,r,s),this.trigger("editablePaste",{currentTarget:s,target:s},s)}.bind(this),0)}},handleKeydown:function(t,n){e.util.isKey(t,e.util.keyCode.V)&&e.util.isMetaCtrlKey(t)&&(t.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(n))},createPasteBin:function(o){var r,s=e.selection.getSelectionRange(this.document),a=this.window.pageYOffset;n=o,s&&((r=s.getClientRects()).length?a+=r[0].top:void 0!==s.startContainer.getBoundingClientRect?a+=s.startContainer.getBoundingClientRect().top:a+=s.getBoundingClientRect().top),t=s;var l=this.document.createElement("div");l.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),l.setAttribute("style","border: 1px red solid; position: absolute; top: "+a+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),l.setAttribute("contentEditable",!0),l.innerHTML="%ME_PASTEBIN%",this.document.body.appendChild(l),this.on(l,"focus",i),this.on(l,"focusin",i),this.on(l,"focusout",i),l.focus(),e.selection.selectNode(l,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(l,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==t&&(e.selection.selectRange(this.document,t),t=null),null!==n&&(n=null);var o=this.getPasteBin();o&&o&&(this.off(o,"focus",i),this.off(o,"focusin",i),this.off(o,"focusout",i),this.off(o,"paste",this.boundHandlePaste),o.parentElement.removeChild(o))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var e=this.getPasteBin();if(!e)return!1;if(e.firstChild&&"mcepastebin"===e.firstChild.id)return!1;var t=e.innerHTML;return!(!t||"%ME_PASTEBIN%"===t)&&t},cleanPaste:function(e){var t,n,i,o,r=/<p|<br|<div/.test(e),s=[].concat(this.preCleanReplacements||[],[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]],this.cleanReplacements||[]);for(t=0;t<s.length;t+=1)e=e.replace(s[t][0],s[t][1]);if(!r)return this.pasteHTML(e);for((i=this.document.createElement("div")).innerHTML="<p>"+e.split("<br><br>").join("</p><p>")+"</p>",n=i.querySelectorAll("a,p,div,br"),t=0;t<n.length;t+=1)switch((o=n[t]).innerHTML=o.innerHTML.replace(/\n/gi," "),o.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(o);break;case"br":this.filterLineBreak(o)}this.pasteHTML(i.innerHTML)},pasteHTML:function(t,n){n=e.util.defaults({},n,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags,unwrapTags:this.unwrapTags});var i,o,r,s,a=this.document.createDocumentFragment();for(a.appendChild(this.document.createElement("body")),(s=a.querySelector("body")).innerHTML=t,this.cleanupSpans(s),i=s.querySelectorAll("*"),r=0;r<i.length;r+=1)"a"===(o=i[r]).nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(o),e.util.cleanupAttrs(o,n.cleanAttrs),e.util.cleanupTags(o,n.cleanTags),e.util.unwrapTags(o,n.unwrapTags);e.util.insertHTMLCommand(this.document,s.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&("p"===e.nodeName.toLowerCase()||"div"===e.nodeName.toLowerCase())},filterCommonBlocks:function(e){/^\s*$/.test(e.textContent)&&e.parentNode&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?this.removeWithParent(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?e.parentNode&&1===e.parentNode.childElementCount&&""===e.parentNode.textContent&&this.removeWithParent(e):this.removeWithParent(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&1===e.parentNode.childElementCount?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e))},cleanupSpans:function(t){var n,i,o,r=t.querySelectorAll(".replace-with"),s=function(e){return e&&"#text"!==e.nodeName&&"false"===e.getAttribute("contenteditable")};for(n=0;n<r.length;n+=1)i=r[n],o=this.document.createElement(i.classList.contains("bold")?"b":"i"),i.classList.contains("bold")&&i.classList.contains("italic")?o.innerHTML="<i>"+i.innerHTML+"</i>":o.innerHTML=i.innerHTML,i.parentNode.replaceChild(o,i);for(r=t.querySelectorAll("span"),n=0;n<r.length;n+=1){if(i=r[n],e.util.traverseUp(i,s))return!1;e.util.unwrap(i,this.document)}}});e.extensions.paste=r}(),c=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(e,t){this.initElement(t)},initElement:function(e){e.getAttribute("data-placeholder")||e.setAttribute("data-placeholder",this.text),this.updatePlaceholder(e)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(e,t){this.cleanupElement(t)},cleanupElement:function(e){e.getAttribute("data-placeholder")===this.text&&e.removeAttribute("data-placeholder")},showPlaceholder:function(t){t&&(e.util.isFF&&0===t.childNodes.length?(t.classList.add("medium-editor-placeholder-relative"),t.classList.remove("medium-editor-placeholder")):(t.classList.add("medium-editor-placeholder"),t.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(e){e&&(e.classList.remove("medium-editor-placeholder"),e.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(e,t){if(e.querySelector("img, blockquote, ul, ol, table")||""!==e.textContent.replace(/^\s+|\s+$/g,""))return this.hidePlaceholder(e);t||this.showPlaceholder(e)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(e,t){var n=this.hideOnClick&&t===this.base.getFocusedElement();this.updatePlaceholder(t,n)},handleFocus:function(e,t){this.hidePlaceholder(t)},handleBlur:function(e,t){this.updatePlaceholder(t)}}),e.extensions.placeholder=c,u=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,static:!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(e,t){return this.base.extensions.forEach(function(n){if(n!==this)return e.apply(t||this,arguments)},this)},createToolbar:function(){var e=this.document.createElement("div");return e.id="medium-editor-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e},createToolbarButtons:function(){var t,n,i,o,r,s,a=this.document.createElement("ul");return a.id="medium-editor-toolbar-actions"+this.getEditorId(),a.className="medium-editor-toolbar-actions",a.style.display="block",this.buttons.forEach(function(i){"string"==typeof i?(r=i,s=null):(r=i.name,s=i),(o=this.base.addBuiltInExtension(r,s))&&"function"==typeof o.getButton&&(n=o.getButton(this.base),t=this.document.createElement("li"),e.util.isElement(n)?t.appendChild(n):t.innerHTML=n,a.appendChild(t))},this),(i=a.querySelectorAll("button")).length>0&&(i[0].classList.add(this.firstButtonClass),i[i.length-1].classList.add(this.lastButtonClass)),a},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(t){if(t&&t.target&&e.util.isDescendant(this.getToolbarElement(),t.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return"block"===this.getToolbarActionsElement().style.display},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(e){e.hasForm&&e.isDisplayed()&&e.hideForm()})},multipleBlockElementsSelected:function(){var t=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),n=e.selection.getSelectionHtml(this.document).replace(/<[^\/>][^>]*><\/[^>]+>/gim,"").match(t);return!!n&&n.length>1},modifySelection:function(){var t=this.window.getSelection().getRangeAt(0);if(this.standardizeSelectionStart&&t.startContainer.nodeValue&&t.startOffset===t.startContainer.nodeValue.length){var n=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),t.startContainer,this.document);if(n){for(var i=0;0===n.nodeValue.substr(i,1).trim().length;)i+=1;t=e.selection.select(this.document,n,i,t.endContainer,t.endOffset)}}},checkState:function(){if(!this.base.preventSelectionUpdates){if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var t=e.selection.getSelectionElement(this.window);return!t||-1===this.getEditorElements().indexOf(t)||t.getAttribute("data-disable-toolbar")?this.hideToolbar():this.updateOnEmptySelection&&this.static?this.showAndUpdateToolbar():!e.selection.selectionContainsContent(this.document)||!1===this.allowMultiParagraphSelection&&this.multipleBlockElementsSelected()?this.hideToolbar():void this.showAndUpdateToolbar()}},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(e){"function"==typeof e.isActive&&"function"==typeof e.setInactive&&e.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var t,n=[],i=null,o=e.selection.getSelectionRange(this.document),r=function(e){"function"==typeof e.checkState?e.checkState(t):"function"==typeof e.isActive&&"function"==typeof e.isAlreadyApplied&&"function"==typeof e.setActive&&!e.isActive()&&e.isAlreadyApplied(t)&&e.setActive()};if(o&&(this.forEachExtension(function(e){"function"!=typeof e.queryCommandState||null===(i=e.queryCommandState())?n.push(e):i&&"function"==typeof e.setActive&&e.setActive()}),t=e.selection.getSelectedParentElement(o),this.getEditorElements().some(function(n){return e.util.isDescendant(n,t,!0)})))for(;t&&(n.forEach(r),!e.util.isMediumEditorElement(t));)t=t.parentNode},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var e=this.base.getFocusedElement(),t=this.window.getSelection();if(!e)return this;!this.static&&t.isCollapsed||(this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(e):this.positionToolbar(t)),this.trigger("positionedToolbar",{},this.base.getFocusedElement()))},positionStaticToolbar:function(e){this.getToolbarElement().style.left="0";var t,n=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,i=this.window.innerWidth,o=this.getToolbarElement(),r=e.getBoundingClientRect(),s=r.top+n,a=r.left+r.width/2,l=o.offsetHeight,c=o.offsetWidth,u=c/2;switch(this.sticky?n>s+e.offsetHeight-l-this.stickyTopOffset?(o.style.top=s+e.offsetHeight-l+"px",o.classList.remove("medium-editor-sticky-toolbar")):n>s-l-this.stickyTopOffset?(o.classList.add("medium-editor-sticky-toolbar"),o.style.top=this.stickyTopOffset+"px"):(o.classList.remove("medium-editor-sticky-toolbar"),o.style.top=s-l+"px"):o.style.top=s-l+"px",this.align){case"left":t=r.left;break;case"right":t=r.right-c;break;case"center":t=a-u}t<0?t=0:t+c>i&&(t=i-Math.ceil(c)-1),o.style.left=t+"px"},positionToolbar:function(e){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var t=e.getRangeAt(0),n=t.getBoundingClientRect();(!n||0===n.height&&0===n.width&&t.startContainer===t.endContainer)&&(n=1===t.startContainer.nodeType&&t.startContainer.querySelector("img")?t.startContainer.querySelector("img").getBoundingClientRect():t.startContainer.getBoundingClientRect());var i,o,r=this.window.innerWidth,s=this.getToolbarElement(),a=s.offsetHeight,l=s.offsetWidth/2,c=this.diffLeft-l,u=this.getEditorOption("elementsContainer"),d={},h={};["absolute","fixed"].indexOf(window.getComputedStyle(u).getPropertyValue("position"))>-1?(o=u.getBoundingClientRect(),["top","left"].forEach(function(e){h[e]=n[e]-o[e]}),h.width=n.width,h.height=n.height,n=h,r=o.width,d.top=u.scrollTop):d.top=this.window.pageYOffset,i=n.left+n.width/2,d.top+=n.top-a,n.top<50?(s.classList.add("medium-toolbar-arrow-over"),s.classList.remove("medium-toolbar-arrow-under"),d.top+=50+n.height-this.diffTop):(s.classList.add("medium-toolbar-arrow-under"),s.classList.remove("medium-toolbar-arrow-over"),d.top+=this.diffTop),i<l?(d.left=c+l,d.right="initial"):r-i<l?(d.left="auto",d.right=0):(d.left=c+i,d.right="initial"),["top","left","right"].forEach(function(e){s.style[e]=d[e]+(isNaN(d[e])?"":"px")})}}),e.extensions.toolbar=u,d=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy","dragover"===e.type?e.target.classList.add("medium-editor-dragover"):"dragleave"===e.type&&e.target.classList.remove("medium-editor-dragover")},handleDrop:function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&Array.prototype.slice.call(t.dataTransfer.files,0).some(function(t){var n,i;t.type.match("image")&&((n=new FileReader).readAsDataURL(t),i="medium-img-"+ +new Date,e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+i+'" />'),n.onload=function(){var e=this.document.getElementById(i);e&&(e.removeAttribute("id"),e.removeAttribute("class"),e.src=n.result)}.bind(this))}.bind(this)),t.target.classList.remove("medium-editor-dragover")}}),e.extensions.imageDragging=d,function(){function t(t,n){if(this.options.disableReturn||n.getAttribute("data-disable-return"))t.preventDefault();else if(this.options.disableDoubleReturn||n.getAttribute("data-disable-double-return")){var i=e.selection.getSelectionStart(this.options.ownerDocument);(i&&""===i.textContent.trim()&&"li"!==i.nodeName.toLowerCase()||i.previousElementSibling&&"br"!==i.previousElementSibling.nodeName.toLowerCase()&&""===i.previousElementSibling.textContent.trim())&&t.preventDefault()}}function n(t){var n,i=e.selection.getSelectionStart(this.options.ownerDocument),o=i.nodeName.toLowerCase(),r=/^(\s+|<br\/?>)?$/i,s=/h\d/i;e.util.isKey(t,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&i.previousElementSibling&&s.test(o)&&0===e.selection.getCaretOffsets(i).left?e.util.isKey(t,e.util.keyCode.BACKSPACE)&&r.test(i.previousElementSibling.innerHTML)?(i.previousElementSibling.parentNode.removeChild(i.previousElementSibling),t.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(t,e.util.keyCode.ENTER)&&((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",i.previousElementSibling.parentNode.insertBefore(n,i),t.preventDefault()):e.util.isKey(t,e.util.keyCode.DELETE)&&i.nextElementSibling&&i.previousElementSibling&&!s.test(o)&&r.test(i.innerHTML)&&s.test(i.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,i.nextElementSibling),i.previousElementSibling.parentNode.removeChild(i),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&"li"===o&&r.test(i.innerHTML)&&!i.previousElementSibling&&!i.parentElement.previousElementSibling&&i.nextElementSibling&&"li"===i.nextElementSibling.nodeName.toLowerCase()?((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",i.parentElement.parentElement.insertBefore(n,i.parentElement),e.selection.moveCursor(this.options.ownerDocument,n),i.parentElement.removeChild(i),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&!1!==e.util.getClosestTag(i,"blockquote")&&0===e.selection.getCaretOffsets(i).left?(t.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(t,e.util.keyCode.ENTER)&&!1!==e.util.getClosestTag(i,"blockquote")&&0===e.selection.getCaretOffsets(i).right?((n=this.options.ownerDocument.createElement("p")).innerHTML="<br>",i.parentElement.insertBefore(n,i.nextSibling),e.selection.moveCursor(this.options.ownerDocument,n),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&e.util.isMediumEditorElement(i.parentElement)&&!i.previousElementSibling&&i.nextElementSibling&&r.test(i.innerHTML)&&(t.preventDefault(),e.selection.moveCursor(this.options.ownerDocument,i.nextSibling),i.parentElement.removeChild(i))}function i(t,n,i){var o=[];if(t||(t=[]),"string"==typeof t&&(t=n.querySelectorAll(t)),e.util.isElement(t)&&(t=[t]),i)for(var r=0;r<t.length;r++){var s=t[r];!e.util.isElement(s)||s.getAttribute("data-medium-editor-element")||s.getAttribute("medium-editor-textarea-id")||o.push(s)}else o=Array.prototype.slice.apply(t);return o}function o(e){var t=e.parentNode.querySelector('textarea[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]');t&&(t.classList.remove("medium-editor-hidden"),t.removeAttribute("medium-editor-textarea-id")),e.parentNode&&e.parentNode.removeChild(e)}function r(e,t,n){return"function"==typeof(e=function(e,t){return Object.keys(t).forEach(function(n){void 0===e[n]&&(e[n]=t[n])}),e}(e,{window:n.options.contentWindow,document:n.options.ownerDocument,base:n})).init&&e.init(),e.name||(e.name=t),e}function s(){return!this.elements.every(function(e){return!!e.getAttribute("data-disable-toolbar")})&&!1!==this.options.toolbar}function a(n,i){if(!n.getAttribute("data-medium-editor-element")){"textarea"===n.nodeName.toLowerCase()&&(n=function(e){for(var t=this.options.ownerDocument.createElement("div"),n=Date.now(),i="medium-editor-"+n,o=e.attributes;this.options.ownerDocument.getElementById(i);)i="medium-editor-"+ ++n;t.className=e.className,t.id=i,t.innerHTML=e.value,e.setAttribute("medium-editor-textarea-id",i);for(var r=0,s=o.length;r<s;r++)t.hasAttribute(o[r].nodeName)||t.setAttribute(o[r].nodeName,o[r].value);return e.form&&this.on(e.form,"reset",function(e){e.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(i))}.bind(this)),e.classList.add("medium-editor-hidden"),e.parentNode.insertBefore(t,e),t}.call(this,n),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=function(e,t){var n=t.parentNode.querySelector('textarea[medium-editor-textarea-id="'+t.getAttribute("medium-editor-textarea-id")+'"]');n&&(n.value=t.innerHTML.trim())}.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),this.options.disableEditing||n.getAttribute("data-disable-editing")||(n.setAttribute("contentEditable",!0),n.setAttribute("spellcheck",this.options.spellcheck)),this.instanceHandleEditableKeydownEnter||(n.getAttribute("data-disable-return")||n.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=t.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),this.options.disableReturn||n.getAttribute("data-disable-return")||this.on(n,"keyup",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument);n&&(e.util.isMediumEditorElement(n)&&0===n.children.length&&!e.util.isBlockContainer(n)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),!e.util.isKey(t,e.util.keyCode.ENTER)||e.util.isListItem(n)||e.util.isBlockContainer(n)||("a"===n.nodeName.toLowerCase()?this.options.ownerDocument.execCommand("unlink",!1,null):t.shiftKey||t.ctrlKey||this.options.ownerDocument.execCommand("formatBlock",!1,"p")))}.bind(this));var o=e.util.guid();n.setAttribute("data-medium-editor-element",!0),n.classList.add("medium-editor-element"),n.setAttribute("role","textbox"),n.setAttribute("aria-multiline",!0),n.setAttribute("data-medium-editor-editor-index",i),n.setAttribute("medium-editor-index",o),d[o]=n.innerHTML,this.events.attachAllEventsToElement(n)}return n}function l(){this.subscribe("editableKeydownTab",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument);"pre"===(n&&n.nodeName.toLowerCase())&&(t.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(n)&&(t.preventDefault(),t.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}.bind(this)),this.subscribe("editableKeydownDelete",n.bind(this)),this.subscribe("editableKeydownEnter",n.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",function(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),i=n.textContent,o=e.selection.getCaretOffsets(n);(void 0===i[o.left-1]||""===i[o.left-1].trim()||void 0!==i[o.left]&&""===i[o.left].trim())&&t.preventDefault()}.bind(this)),this.instanceHandleEditableKeydownEnter||(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=t.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function c(){if(this.extensions=[],Object.keys(this.options.extensions).forEach(function(e){"toolbar"!==e&&this.options.extensions[e]&&this.extensions.push(r(this.options.extensions[e],e,this))},this),function(){return!this.options.extensions.imageDragging}.call(this)){var t=this.options.fileDragging;t||(t={},function(){return!1!==this.options.imageDragging}.call(this)||(t.allowedTypes=[])),this.addBuiltInExtension("fileDragging",t)}var n={paste:!0,"anchor-preview":function(){return!!s.call(this)&&!1!==this.options.anchorPreview}.call(this),autoLink:function(){return!1!==this.options.autoLink}.call(this),keyboardCommands:function(){return!1!==this.options.keyboardCommands}.call(this),placeholder:function(){return!1!==this.options.placeholder}.call(this)};Object.keys(n).forEach(function(e){n[e]&&this.addBuiltInExtension(e)},this);var i=this.options.extensions.toolbar;if(!i&&s.call(this)){var o=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});i=new e.extensions.toolbar(o)}i&&this.extensions.push(r(i,"toolbar",this))}function u(t,n){var i,o;if(i=/^append-(.+)$/gi.exec(t))return e.util.execFormatBlock(this.options.ownerDocument,i[1]);if("fontSize"===t)return n.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),o=n.value||n.size,this.options.ownerDocument.execCommand("fontSize",!1,o);if("fontName"===t)return n.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),o=n.value||n.name,this.options.ownerDocument.execCommand("fontName",!1,o);if("createLink"===t)return this.createLink(n);if("image"===t){var r=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,r)}if("html"===t){var s=this.options.contentWindow.getSelection().toString().trim();return e.util.insertHTMLCommand(this.options.ownerDocument,s)}if(/justify([A-Za-z]*)$/g.exec(t)){var a=this.options.ownerDocument.execCommand(t,!1,null),l=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return l&&function(t){if(!t)return;var n,i=Array.prototype.slice.call(t.childNodes).filter(function(e){var t="div"===e.nodeName.toLowerCase();return t&&!n&&(n=e.style.textAlign),t});i.length&&(this.saveSelection(),i.forEach(function(t){if(t.style.textAlign===n){var i=t.lastChild;if(i){e.util.unwrap(t,this.options.ownerDocument);var o=this.options.ownerDocument.createElement("BR");i.parentNode.insertBefore(o,i.nextSibling)}}},this),t.style.textAlign=n,this.restoreSelection())}.call(this,e.util.getTopBlockContainer(l)),a}return o=n&&n.value,this.options.ownerDocument.execCommand(t,!1,o)}var d={};e.prototype={init:function(t,n){return this.options=function(t,n){return n&&[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]].forEach(function(t){n.hasOwnProperty(t[0])&&void 0!==n[t[0]]&&e.util.deprecated(t[0],t[1],"v6.0.0")}),e.util.defaults({},n,t)}.call(this,this.defaults,n),this.origElements=t,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){this.isActive||(function(e){e._mediumEditors||(e._mediumEditors=[null]),this.id||(this.id=e._mediumEditors.length),e._mediumEditors[this.id]=this}.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements),0!==this.elements.length&&(this.isActive=!0,c.call(this),l.call(this)))},destroy:function(){this.isActive&&(this.isActive=!1,this.extensions.forEach(function(e){"function"==typeof e.destroy&&e.destroy()},this),this.events.destroy(),this.elements.forEach(function(e){this.options.spellcheck&&(e.innerHTML=e.innerHTML),e.removeAttribute("contentEditable"),e.removeAttribute("spellcheck"),e.removeAttribute("data-medium-editor-element"),e.classList.remove("medium-editor-element"),e.removeAttribute("role"),e.removeAttribute("aria-multiline"),e.removeAttribute("medium-editor-index"),e.removeAttribute("data-medium-editor-editor-index"),e.getAttribute("medium-editor-textarea-id")&&o(e)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,function(e){e._mediumEditors&&e._mediumEditors[this.id]&&(e._mediumEditors[this.id]=null)}.call(this,this.options.contentWindow))},on:function(e,t,n,i){return this.events.attachDOMEvent(e,t,n,i),this},off:function(e,t,n,i){return this.events.detachDOMEvent(e,t,n,i),this},subscribe:function(e,t){return this.events.attachCustomEvent(e,t),this},unsubscribe:function(e,t){return this.events.detachCustomEvent(e,t),this},trigger:function(e,t,n){return this.events.triggerCustomEvent(e,t,n),this},delay:function(e){var t=this;return setTimeout(function(){t.isActive&&e()},this.options.delay)},serialize:function(){var e,t={},n=this.elements.length;for(e=0;e<n;e+=1)t[""!==this.elements[e].id?this.elements[e].id:"element-"+e]={value:this.elements[e].innerHTML.trim()};return t},getExtensionByName:function(e){var t;return this.extensions&&this.extensions.length&&this.extensions.some(function(n){return n.name===e&&(t=n,!0)}),t},addBuiltInExtension:function(t,n){var i,o=this.getExtensionByName(t);if(o)return o;switch(t){case"anchor":i=e.util.extend({},this.options.anchor,n),o=new e.extensions.anchor(i);break;case"anchor-preview":o=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":o=new e.extensions.autoLink;break;case"fileDragging":o=new e.extensions.fileDragging(n);break;case"fontname":o=new e.extensions.fontName(this.options.fontName);break;case"fontsize":o=new e.extensions.fontSize(n);break;case"keyboardCommands":o=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":o=new e.extensions.paste(this.options.paste);break;case"placeholder":o=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(t)&&(n?(i=e.util.defaults({},n,e.extensions.button.prototype.defaults[t]),o=new e.extensions.button(i)):o=new e.extensions.button(t))}return o&&this.extensions.push(r(o,t,this)),o},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var e=this.getExtensionByName("toolbar");return e&&e.checkState(),this},queryCommandState:function(e){var t,n=null;(t=/^full-(.+)$/gi.exec(e))&&(e=t[1]);try{n=this.options.ownerDocument.queryCommandState(e)}catch(e){n=null}return n},execAction:function(t,n){var i,o;return(i=/^full-(.+)$/gi.exec(t))?(this.saveSelection(),this.selectAllContents(),o=u.call(this,i[1],n),this.restoreSelection()):o=u.call(this,t,n),"insertunorderedlist"!==t&&"insertorderedlist"!==t||e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),o},getSelectedParentElement:function(t){return void 0===t&&(t=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(t)},selectAllContents:function(){var t=e.selection.getSelectionElement(this.options.contentWindow);if(t){for(;1===t.children.length;)t=t.children[0];this.selectElement(t)}},selectElement:function(t){e.selection.selectNode(t,this.options.ownerDocument);var n=e.selection.getSelectionElement(this.options.contentWindow);n&&this.events.focusElement(n)},getFocusedElement:function(){var e;return this.elements.some(function(t){return!e&&t.getAttribute("data-medium-focused")&&(e=t),!!e},this),e},exportSelection:function(){var t=e.selection.getSelectionElement(this.options.contentWindow),n=this.elements.indexOf(t),i=null;return n>=0&&(i=e.selection.exportSelection(t,this.options.ownerDocument)),null!==i&&0!==n&&(i.editableElementIndex=n),i},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(t,n){if(t){var i=this.elements[t.editableElementIndex||0];e.selection.importSelection(t,i,this.options.ownerDocument,n)}},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(t){var n,i=e.selection.getSelectionElement(this.options.contentWindow),o={};if(-1!==this.elements.indexOf(i)){try{if(this.events.disableCustomEvent("editableInput"),t.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),(n=t.url||t.value)&&n.trim().length>0){var r=this.options.contentWindow.getSelection();if(r){var s,a,l,c,u=r.getRangeAt(0),d=u.commonAncestorContainer;if(3===u.endContainer.nodeType&&3!==u.startContainer.nodeType&&0===u.startOffset&&u.startContainer.firstChild===u.endContainer&&(d=u.endContainer),a=e.util.getClosestBlockContainer(u.startContainer),l=e.util.getClosestBlockContainer(u.endContainer),3!==d.nodeType&&0!==d.textContent.length&&a===l){var h=a||i,f=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),s=this.exportSelection(),f.appendChild(h.cloneNode(!0)),i===h?e.selection.select(this.options.ownerDocument,h.firstChild,0,h.lastChild,3===h.lastChild.nodeType?h.lastChild.nodeValue.length:h.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,h,0,h,h.childNodes.length);var p=this.exportSelection();0===(c=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,f,{start:s.start-p.start,end:s.end-p.start,editableElementIndex:s.editableElementIndex})).length&&((f=this.options.ownerDocument.createDocumentFragment()).appendChild(d.cloneNode(!0)),c=[f.firstChild.firstChild,f.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,c,n.trim());var m=(f.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,f.firstChild.innerHTML.replace(/^\s+/,"")),s.start-=m,s.end-=m,this.importSelection(s)}else this.options.ownerDocument.execCommand("createLink",!1,n);this.options.targetBlank||"_blank"===t.target?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),n):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),n),t.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),t.buttonClass)}}if(this.options.targetBlank||"_blank"===t.target||t.buttonClass){(o=this.options.ownerDocument.createEvent("HTMLEvents")).initEvent("input",!0,!0,this.options.contentWindow);for(var v=0,g=this.elements.length;v<g;v+=1)this.elements[v].dispatchEvent(o)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",o,i)}},cleanPaste:function(e){this.getExtensionByName("paste").cleanPaste(e)},pasteHTML:function(e,t){this.getExtensionByName("paste").pasteHTML(e,t)},setContent:function(e,t){if(t=t||0,this.elements[t]){var n=this.elements[t];n.innerHTML=e,this.checkContentChanged(n)}},getContent:function(e){return e=e||0,this.elements[e]?this.elements[e].innerHTML.trim():null},checkContentChanged:function(t){t=t||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(t,{target:t,currentTarget:t})},resetContent:function(e){if(e){var t=this.elements.indexOf(e);-1!==t&&this.setContent(d[e.getAttribute("medium-editor-index")],t)}else this.elements.forEach(function(e,t){this.setContent(d[e.getAttribute("medium-editor-index")],t)},this)},addElements:function(e){var t=i(e,this.options.ownerDocument,!0);if(0===t.length)return!1;t.forEach(function(e){e=a.call(this,e,this.id),this.elements.push(e),this.trigger("addElement",{target:e,currentTarget:e},e)},this)},removeElements:function(e){var t=i(e,this.options.ownerDocument).map(function(e){return e.getAttribute("medium-editor-textarea-id")&&e.parentNode?e.parentNode.querySelector('div[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]'):e});this.elements=this.elements.filter(function(e){return-1===t.indexOf(e)||(this.events.cleanupElement(e),e.getAttribute("medium-editor-textarea-id")&&o(e),this.trigger("removeElement",{target:e,currentTarget:e},e),!1)},this)}},e.getEditorFromElement=function(e){var t=e.getAttribute("data-medium-editor-editor-index"),n=e&&e.ownerDocument&&(e.ownerDocument.defaultView||e.ownerDocument.parentWindow);return n&&n._mediumEditors&&n._mediumEditors[t]?n._mediumEditors[t]:null}}(),e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0},e.parseVersionString=function(e){var t=e.split("-"),n=t[0].split("."),i=t.length>1?t[1]:"";return{major:parseInt(n[0],10),minor:parseInt(n[1],10),revision:parseInt(n[2],10),preRelease:i,toString:function(){return[n[0],n[1],n[2]].join(".")+(i?"-"+i:"")}}},e.version=e.parseVersionString.call(this,"5.23.3"),e}())}).call(t,n(62))},function(e,t){var n,i,o=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&f())}function f(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";function i(e){if(void 0!==e.label&&/\S{1}/.test(e.label)&&void 0!==e.start&&/\S{1}/.test(e.start)&&void 0!==e.end&&/\S{1}/.test(e.end)||void 0!==e.label&&/\S{1}/.test(e.label)&&void 0!==e.action&&/\S{1}/.test(e.action)){e.start=void 0===e.start?"":e.start,e.end=void 0===e.end?"":e.end;var t=this;this.options=e,this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML=e.label,this.button.onclick=function(){var n,i,r=o(),s=window.getSelection(),a=s.anchorNode.parentElement;if(void 0===e.start||-1==r.indexOf(e.start)&&-1==r.indexOf(e.end)?(void 0!=e.action&&(r=e.action(r,!0,a)),r=e.start+r+e.end):(void 0!=e.action&&(r=e.action(r,!1,a)),r=String(r).split(e.start).join(""),r=String(r).split(e.end).join("")),s.getRangeAt&&s.rangeCount){if((n=window.getSelection().getRangeAt(0)).deleteContents(),n.createContextualFragment)i=n.createContextualFragment(r);else{var l=document.createElement("div");for(l.innerHTML=r,i=document.createDocumentFragment();child=l.firstChild;)i.appendChild(child)}var c=i.firstChild,u=i.lastChild;n.insertNode(i),c&&(n.setStartBefore(c),n.setEndAfter(u)),s.removeAllRanges(),s.addRange(n)}t.base.checkContentChanged()}}else console.error('[Custom-Button] You need to specify "label", "start" and "end" OR "label" and "action"')}function o(){var e,t="";if(void 0!==window.getSelection){if((e=window.getSelection()).rangeCount){for(var n=document.createElement("div"),i=0,o=e.rangeCount;i<o;++i)n.appendChild(e.getRangeAt(i).cloneContents());t=n.innerHTML}}else void 0!==document.selection&&"Text"==document.selection.type&&(t=document.selection.createRange().htmlText);return t}i.prototype.getButton=function(){return this.button},i.prototype.checkState=function(e){var t=o();""!=this.options.start&&t.indexOf(this.options.start)>-1&&t.indexOf(this.options.end)>-1?this.button.classList.add("medium-editor-button-active"):this.button.classList.remove("medium-editor-button-active")},void 0!==e&&e.exports&&(t=e.exports=i),t.MediumButton=i},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i},a=n(67);n(72);var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;return window.povSSE.on(EVENTS.SSE_INFO,function(e){e.humanMessage&&i.notify(e.humanMessage,5,"white")}),e.on("mouseenter",function(){i.pauseAll()}),e.on("mouseleave",function(){i.resumeAll()}),Pov.events.on(EVENTS.XDEBUG_DETECTED,function(e){i.notify(e.firstLine,5,"danger","cq-bug-report")}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"$allNotifications",value:function(){return this.$main.find("[cq-notification]")}},{key:"pauseAll",value:function(){this.$allNotifications().each(function(){$(this).CqNotification().pause()})}},{key:"resumeAll",value:function(){this.$allNotifications().each(function(){$(this).CqNotification().resume()})}},{key:"notify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",i=arguments[3],o=arguments[4];if(STAGE.visible()){o&&this.$notificationByUid(o).remove();var r=new a.CqNotification(null,e,n,t,i,o);this.$main.prepend(r.$main),TweenMax.from(r.$main,.2,{scale:0})}}},{key:"$notificationByUid",value:function(e){return this.$main.find("[cq-notification-about-uid='"+e+"']")}},{key:"destroy",value:function(){}}]),t}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CqNotification=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(0)),r=s(n(19));s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}n(70);var a=t.CqNotification=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"...",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"cq-circle-filled-info",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!e){var c=n(71)({theme:o,message:window.pov.utils.decodeHtml(i),uid:l});e=$(c)}e.find("main").html(i),a&&e.find(">.icon").append("<svg class='svg'><use class='svg' href='#"+a+"'></use></svg>");var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),d=u;return u.progress=new r.default(u.$main.find("[cq-progress-bar]")),u.timer=TweenMax.fromTo(u.progress,s,{progress:0},{progress:100,ease:Linear.EaseNone,onComplete:function(){d.remove()}}),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"pause",value:function(){this.timer.pause()}},{key:"resume",value:function(){this.timer.resume()}},{key:"remove",value:function(e){var t=this;TweenMax.to(t.$main,.4,{height:0,paddingTop:0,paddingBottom:0,marginTop:0,marginBottom:0,ease:Sine.easeIn,onComplete:function(){t.$main.remove()}})}},{key:"destroy",value:function(){}}]),t}();$.fn.CqNotification=function(){return $(this).is("[cq-notification='init']")?$(this).data("CqNotification"):new a($(this))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=(i=r)&&i.__esModule?i:{default:i};var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.max=Number(e.attr("max")),n.min=Number(e.attr("min")),n._value=Number(e.attr("progress")),n.min=n.min?n.min:0,n.max=n.max?n.max:1,n._value=n._value?n._value:0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destroy",value:function(){}},{key:"progress",set:function(e){this._value=e},get:function(){return this._value}}]),t}();t.default=a},function(e,t){},function(e,t){},function(e,t,n){var i=n(5);e.exports=function(){var e=new i.Template({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<div cq-notification class="cq-th-'),i.b(i.v(i.f("theme",e,t,0))),i.b('" cq-notification-about-uid="'),i.b(i.v(i.f("uid",e,t,0))),i.b('">\r'),i.b("\n"+n),i.b("\r"),i.b("\n"+n),i.b('    <div class="icon"></div>\r'),i.b("\n"+n),i.b("    <main>\r"),i.b("\n"+n),i.b("        "),i.b(i.v(i.f("message",e,t,0))),i.b("\r"),i.b("\n"+n),i.b("    </main>\r"),i.b("\n"+n),i.b('    <div cq-progress-bar value="0" min="0" max="100">\r'),i.b("\n"+n),i.b('        <div class="bar"></div>\r'),i.b("\n"+n),i.b("    </div>\r"),i.b("\n"+n),i.b("</div>"),i.fl()},partials:{},subs:{}},'<div cq-notification class="cq-th-{{theme}}" cq-notification-about-uid="{{uid}}">\r\n\r\n    <div class="icon"></div>\r\n    <main>\r\n        {{message}}\r\n    </main>\r\n    <div cq-progress-bar value="0" min="0" max="100">\r\n        <div class="bar"></div>\r\n    </div>\r\n</div>',i);return e.render.apply(e,arguments)}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=s(n(0)),r=(s(n(6)),s(n(3)));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;function o(){i.list.$main.trigger("change")}return n.list=e.find("[cq-sortable]").CqSortable(),n.$btn=e.find("button[wysiwyg-var][wysiwyg-data-type='records']"),n.multiple="true"===n.$btn.attr("wysiwyg-multiple"),n.field=new r.default(n.$btn),n.$btn.on("click",function(){wysiwyg.recordSelector.getUids(i.multiple,$(this).attr("wysiwyg-records-types"),i.field.value()).then(function(e){i.multiple||i.list.$main.empty(),i.list.$main.append(wysiwyg.recordSelector.$recordsPreviews(e)),o()},function(){})}),n.list.$main.on("change",function(){var e=[];i.list.$main.find("[data-pov-vv-uid]").each(function(){e.push($(this).attr("data-pov-vv-uid"))}),i.field.$field.val(e),i.field.doSave(!0)}),n.list.$main.on("mouseenter",".preview-record",function(){var e=$(this);wysiwyg.contextMenu.show().setAnchor(e).btns.reset(),e.is(":first-child")||wysiwyg.contextMenu.btns.before(function(){e.insertBefore(e.prev()),o()}),e.is(":last-child")||wysiwyg.contextMenu.btns.after(function(){e.insertAfter(e.next()),o()}),wysiwyg.contextMenu.btns.trash(function(){e.remove(),o()})}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"destroy",value:function(){}}]),t}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(75),s=(i=r)&&i.__esModule?i:{default:i};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.db=new s.default,this.ui={bigMenu:wysiwyg.bigMenu,recordEditor:wysiwyg.recordEditor},window.cqEventsListener.addObject(this),window.cqEventsListener.addListener(EVENTS.SSE_DB_CHANGE,"cq-on-model-saved"),window.cqEventsListener.addListener(EVENTS.SSE_DB_TRASH,"cq-on-model-trash"),this.notify={apiResponse:function(e){var t="white",n="cq-circle-info",i="";e.success||(t="danger",n="cq-circle-error",i=e.errors.join("<br>")),i&&wysiwyg.notifier.notify(i,10,t,n)}},this._initSSEEvents()}return o(e,[{key:"editRecord",value:function(e){this.ui.recordEditor.displayUid(e)}},{key:"_initSSEEvents",value:function(){window.povSSE.on(EVENTS.SSE_DB_CHANGE,function(e){(window.wysiwyg.notifier.notify(e.humanMessage,3,"white","cq-edit",e.vars.uid),e.vars.uid)&&$("[data-pov-vv-uid='"+e.vars.uid+"']").trigger(EVENTS.SSE_DB_CHANGE)}),window.povSSE.on(EVENTS.SSE_DB_TRASH,function(e){if(window.wysiwyg.notifier.notify(e.humanMessage,4,"danger","cq-trash"),e.vars.uid){var t=$("[data-pov-vv-uid='"+e.vars.uid+"']");t.css("opacity","0.2"),t.trigger(EVENTS.SSE_DB_TRASH),PovHistory.currentPageInfo.uid&&PovHistory.currentPageInfo.uid===e.vars.uid&&PovHistory.goToHomePage()}})}},{key:"refresh",value:function(){$(this).povRefresh()}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toto="rigolo"}return i(e,[{key:"trash",value:function(e){return new Promise(function(t,n){confirm("Êtes vous certain?")&&window.pov.api.delete({uid:e},function(e){console.log(e),e.success?t(e):(cqAdmin.notify.apiResponse(e),n(e))})})}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CqFieldUpload=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=a(n(0)),r=a(n(3)),s=a(n(19));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(77);t.CqFieldUpload=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(!e.is("[wysiwyg-var][wysiwyg-data-type='file']")){var i="wrong CqFieldUpload";return alert(i),console.error(i,e),l(n)}n.field=new r.default(e),n.$inputFile=e.find("input[type='file']"),n.$progressText=e.find("[data-progress-text]");var o=e.find("[cq-progress-bar]");return n.progressbar=new s.default(o),n._startUpload(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"_startUpload",value:function(){var e=this;e.$main.attr("state","uploading"),window.pov.api.upload(e.$inputFile.get(0).files[0],function(t){console.log("uploading file "+t),e.$progressText.text(String(t)+"%"),e.progressbar.progress=t}).then(function(t){console.log("upload ok json",t),e.field.$field.attr("wysiwyg-value",t.json.record.uid),e.field.doSave(!0),e.$main.attr("state","")},function(){console.error("erreur upload"),e.$main.attr("state","error")})}}]),t}()},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);
//# sourceMappingURL=wysiwyg.js.map